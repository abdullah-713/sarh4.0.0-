# 8. ูุธุงู ุงูุชุญูููุงุช

## 8.1 ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุชุญูููุงุช ุดุงูู (889 ุณุทุฑูุง) ููููุฑ ุฑุคู ุนูููุฉ ุนู ุฃุฏุงุก ุงููุฑูุน ูุงูููุธููู ุนุจุฑ ุฎุฏูุฉ `AnalyticsService`.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   AnalyticsService                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงูููุงููุณ ุงูุฃุณุงุณูุฉ                                           โ
โ  โโโ VPM (ุงููููุฉ ููู ุฏูููุฉ)                                 โ
โ  โโโ calculateTotalLoss (ุงูุฎุณุงุฑุฉ ุงูุฅุฌูุงููุฉ)                  โ
โ  โโโ calculateProductivityGap (ูุฌูุฉ ุงูุฅูุชุงุฌูุฉ)              โ
โ  โโโ calculateEfficiencyScore (ุฏุฑุฌุฉ ุงูููุงุกุฉ ุงููุฑููุจุฉ)        โ
โ                                                              โ
โ  ุงูุชุญูููุงุช ุงููุชูุฏูุฉ                                          โ
โ  โโโ calculateROIMatrix (ูุตูููุฉ ุงูุนุงุฆุฏ ุนูู ุงูุงุณุชุซูุงุฑ)        โ
โ  โโโ generateHeatmapData (ุฎุฑูุทุฉ ุญุฑุงุฑูุฉ)                     โ
โ  โโโ getLostOpportunityClock (ุณุงุนุฉ ุงููุฑุตุฉ ุงูุถุงุฆุนุฉ)          โ
โ                                                              โ
โ  ุงูุชุดุงู ุงูุฃููุงุท                                             โ
โ  โโโ detectFrequentLatePattern (ููุท ุงูุชุฃุฎุฑ ุงููุชูุฑุฑ)         โ
โ  โโโ detectPreHolidayPattern (ููุท ูุง ูุจู ุงูุนุทูุฉ)            โ
โ  โโโ detectMonthlyCyclePattern (ููุท ุงูุฏูุฑุฉ ุงูุดูุฑูุฉ)         โ
โ                                                              โ
โ  ุงูุชูุจููุงุช ูุงูุชูุงุฑูุฑ                                        โ
โ  โโโ checkAndTriggerAlerts (ุงูุชูุจููุงุช ุงูุชููุงุฆูุฉ)             โ
โ  โโโ generateDailySnapshot (ุงูููุทุฉ ุงูููููุฉ)                 โ
โ  โโโ runFullAnalysis (ุงูุชุญููู ุงูุดุงูู)                       โ
โ  โโโ getPersonalMirror (ุงููุฑุขุฉ ุงูุดุฎุตูุฉ)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 8.2 ุงูููุงููุณ ุงูุฃุณุงุณูุฉ

### 8.2.1 VPM โ ุงููููุฉ ููู ุฏูููุฉ

```
VPM = ููุฒุงููุฉ_ุงูุฑูุงุชุจ_ุงูุดูุฑูุฉ รท (ููุธููู ร ุฃูุงู_ุนูู ร ุณุงุนุงุช ร 60)
```

- ูุณุชุจุนุฏ ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน (ุงูุฌูุนุฉ ูุงูุณุจุช)
- ูุณุชุจุนุฏ ุงูุนุทูุงุช ุงูุฑุณููุฉ ุงููุณุฌูุฉ

### 8.2.2 ุฅุฌูุงูู ุงูุฎุณุงุฑุฉ โ `calculateTotalLoss()`

```
ุงูุฎุณุงุฑุฉ = ุฎุณุงุฑุฉ_ุงูุชุฃุฎูุฑ + ุฎุณุงุฑุฉ_ุงูุบูุงุจ + ุฎุณุงุฑุฉ_ุงููุบุงุฏุฑุฉ_ุงููุจูุฑุฉ

ุฎุณุงุฑุฉ ุงูุชุฃุฎูุฑ = ูุฌููุน delay_cost ูู ุณุฌูุงุช ุงูุญุถูุฑ
ุฎุณุงุฑุฉ ุงูุบูุงุจ = (ููุธููู_ูุดุทูู - ุญุงุถุฑูู) ร ุฏูุงุฆู_ุงููุฑุฏูุฉ ร VPM
ุฎุณุงุฑุฉ ุงููุบุงุฏุฑุฉ = ูุฌููุน early_leave_cost
```

> โ๏ธ ูุชุฎุทู ุฃูุงู ุงูุฌูุนุฉ/ุงูุณุจุช ูุงูุนุทูุงุช

### 8.2.3 ูุฌูุฉ ุงูุฅูุชุงุฌูุฉ โ `calculateProductivityGap()`

```
ุงููุฌูุฉ = ((ุงููุณุชูุฏู% - ุงููุนูู%) รท ุงููุณุชูุฏู%) ร 100

ุงููุณุชูุฏู ุงูุงูุชุฑุงุถู: 95%
ูุซุงู: ((95 - 82) รท 95) ร 100 = 13.68%
```

### 8.2.4 ุฏุฑุฌุฉ ุงูููุงุกุฉ ุงููุฑููุจุฉ โ `calculateEfficiencyScore()`

ุฏุฑุฌุฉ ูู 0 ุฅูู 100 ุชุฌูุน ุจูู ุฃุฑุจุนุฉ ุนูุงูู:

| ุงูุนุงูู | ุงููุฒู | ุงูุญุณุงุจ |
|--------|-------|--------|
| ูุณุจุฉ ุงูุญุถูุฑ | 40% | (ุญุงุถุฑูู รท ุฅุฌูุงูู_ุงูุณุฌูุงุช) ร 100 |
| ุงูุงูุถุจุงุท | 30% | 100 - (ูุชูุณุท_ุงูุชุฃุฎูุฑ_ุจุงูุฏูุงุฆู รท 30 ร 100) |
| ุงูุงุญุชูุงุธ | 20% | (ุฏูุงุฆู_ุนูู_ูุนููุฉ รท ุฏูุงุฆู_ูุชููุนุฉ) ร 100 |
| ุฃูุงู ุจุฏูู ุฎุณุงุฑุฉ | 10% | (ุฃูุงู_ุฎุณุงุฑุฉ_ุตูุฑ รท ุฅุฌูุงูู_ุงูุฃูุงู) ร 100 |

---

## 8.3 ุงูุชุญูููุงุช ุงููุชูุฏูุฉ

### 8.3.1 ูุตูููุฉ ROI โ `calculateROIMatrix()`

ููู ูุฑุน:

```
ROI = (ุงูููุฒุงููุฉ - ุงูุฎุณุงุฆุฑ) รท ุงูููุฒุงููุฉ ร 100
```

ุงูุชุตููู ูู ุฃุฑุจุงุน:

| ุงูุฑุจุน | ุงูุดุฑุท | ุงููุตู |
|-------|-------|-------|
| โญ Star (ูุฌู) | ROI โฅ 90% **ู** ููุงุกุฉ โฅ 70% | ุฃุฏุงุก ููุชุงุฒ |
| ๐ฐ Cash Cow (ุจูุฑุฉ ุญููุจ) | ROI โฅ 90% **ู** ููุงุกุฉ < 70% | ูุฑุจุญ ููู ูุญุชุงุฌ ุชุญุณูู |
| ๐ Potential (ูุงุนุฏ) | ROI < 90% **ู** ููุงุกุฉ โฅ 70% | ููุก ููู ุงูุฎุณุงุฆุฑ ูุฑุชูุนุฉ |
| โ๏ธ At Risk (ูู ุฎุทุฑ) | ROI < 90% **ู** ููุงุกุฉ < 70% | ูุญุชุงุฌ ุชุฏุฎู ุนุงุฌู |

### 8.3.2 ุงูุฎุฑูุทุฉ ุงูุญุฑุงุฑูุฉ โ `generateHeatmapData()`

ุจูุงูุงุช ุจูุนุฏูู:

1. **ุงูุชูุฒูุน ุงูุณุงุนู**: ุนุฏุฏ ุชุณุฌููุงุช ุงูุญุถูุฑ ููู ุณุงุนุฉ (6-23)
2. **ุงูุชูุฒูุน ุงููููู**: ุญุงุถุฑ/ูุชุฃุฎุฑ/ุบุงุฆุจ ููู ููู ูู ุงูุฃุณุจูุน

### 8.3.3 ุณุงุนุฉ ุงููุฑุตุฉ ุงูุถุงุฆุนุฉ โ `getLostOpportunityClock()`

```php
ุงููุชูุฌุฉ = [
    'total_loss'          => 12,450.30,  // ุฑ.ุณ โ ุฅุฌูุงูู ุฎุณุงุฆุฑ ุงูููู
    'total_delay_minutes' => 1,234,      // ุฅุฌูุงูู ุฏูุงุฆู ุงูุชุฃุฎูุฑ
    'absent_count'        => 15,         // ุนุฏุฏ ุงูุบุงุฆุจูู
    'branches'            => [           // ุฃุนูู 5 ูุฑูุน ุฎุณุงุฑุฉ
        ['name' => 'ุงููุฑุน ุงูุฑุฆูุณู', 'loss' => 5,200.00],
        ...
    ]
]
```

---

## 8.4 ุงูุชุดุงู ุงูุฃููุงุท

### 8.4.1 ููุท ุงูุชุฃุฎุฑ ุงููุชูุฑุฑ โ `detectFrequentLatePattern()`

- **ุงููุชุฑุฉ**: ุขุฎุฑ 14 ููููุง
- **ุงูุดุฑุท**: ุชุฃุฎุฑ โฅ 3 ูุฑุงุช
- **ุฏุฑุฌุฉ ุงูุฎุทุฑ**: `min(100, ุนุฏุฏ_ุงูุชุฃุฎุฑุงุช รท 10 ร 100)`
- ูููุดุฆ/ููุญุฏูุซ ุณุฌู `EmployeePattern`

### 8.4.2 ููุท ูุง ูุจู ุงูุนุทูุฉ โ `detectPreHolidayPattern()`

- **ุงููุชุฑุฉ**: 3 ุฃุดูุฑ
- **ุงูุดุฑุท**: ุบูุงุจ ูุจู ุฃู ุจุนุฏ ุงูุนุทูุงุช ุจูุณุจุฉ โฅ 50%
- **ูุณุชููุงุช ุงูุฎุทุฑ**:
  - โฅ 80% โ critical (ุญุฑุฌ)
  - โฅ 60% โ high (ูุฑุชูุน)
  - ุบูุฑ ุฐูู โ medium (ูุชูุณุท)

### 8.4.3 ููุท ุงูุฏูุฑุฉ ุงูุดูุฑูุฉ โ `detectMonthlyCyclePattern()`

- **ุงููุชุฑุฉ**: 3 ุฃุดูุฑ
- **ุงูุดุฑุท**: ููู ูุญุฏุฏ ูู ุงูุฃุณุจูุน ุจูุณุจุฉ ุชุฃุฎุฑ > 60% ูู โฅ 4 ุนููุงุช
- ูุซุงู: "ุงูุฃุญุฏ" ุชุฃุฎุฑ 70% ูู ุงููุฑุงุช โ ููุท ููุชุดู

---

## 8.5 ูุธุงู ุงูุชูุจููุงุช โ `checkAndTriggerAlerts()`

ูููุดุฆ ุชูุจููุงุช `LossAlert` ุชููุงุฆููุง ุนูุฏ:

| ุงูููุน | ุงูุดุฑุท | ุงูุฎุทูุฑุฉ |
|-------|-------|---------|
| `threshold_exceeded` | ุฎุณุงุฑุฉ ููููุฉ > ุงูุญุฏ ุงูุฃูุตู ุงูููุจูู | ุญุณุจ ุงููุณุจุฉ |
| `low_attendance` | ูุณุจุฉ ุงูุญุถูุฑ ุฃูู ูู ุงููุณุชูุฏู ุจู > 10% | high |
| `mass_late` | > 30% ูู ุงูููุธููู ูุชุฃุฎุฑูู | high |

---

## 8.6 ุงูููุทุฉ ุงูููููุฉ โ `generateDailySnapshot()`

ุชูุญูุธ ูู ุฌุฏูู `analytics_snapshots` ูููููุง ููู ูุฑุน:

```json
{
    "attendance_rate": 87.5,
    "late_rate": 10.2,
    "absent_rate": 2.3,
    "delay_loss": 3450.00,
    "absence_loss": 1200.00,
    "total_loss": 4650.00,
    "vpm": 0.95,
    "productivity_gap": 7.89,
    "efficiency_score": 78.5,
    "heatmap": { ... }
}
```

---

## 8.7 ุงูุชุญููู ุงูุดุงูู โ `runFullAnalysis()`

**ุงูุฃูุฑ**: `php artisan sarh:analytics --date=2026-02-01`

ููู ูุฑุน ูุดุท:
1. โ ุชูููุฏ ุงูููุทุฉ ุงูููููุฉ
2. โ ูุญุต ูุฅุทูุงู ุงูุชูุจููุงุช
3. โ ุงูุชุดุงู ุงูุฃููุงุท (ุฃูุงู ุงูุฃุญุฏ ููุท โ ูุชุฌูุจ ุงูุชูุฑุงุฑ)

---

## 8.8 ุงููุฑุขุฉ ุงูุดุฎุตูุฉ โ `getPersonalMirror()`

ุนุฑุถ ุฃุฏุงุก ุงูููุธู ุงูุฐุงุชู (ูู ุจูุงุจุฉ ุงูููุธู):

```php
ุงููุชูุฌุฉ = [
    'performance_score' => 85.0,        // 60% ุญุถูุฑ + 40% ุงูุถุจุงุท
    'present_days'      => 20,
    'late_days'         => 2,
    'absent_days'       => 0,
    'total_delay'       => 25,          // ุฏูุงุฆู
    'total_loss'        => 23.68,       // ุฑ.ุณ
    'current_streak'    => 15,
    'rank_in_branch'    => 3,           // ุงูุชุฑุชูุจ
    'percentile'        => 87.5,        // ุงููุฆูู
    'motivational_message' => 'ุฃุฏุงุก ุฑุงุฆุน! ุฃูุช ูู ุฃูุถู 15% ูู ูุฑุนู!'
]
```

---

## 8.9 ุงูููุงุณ ุนู ุจูุนุฏ (Telemetry)

### TelemetryService

ูุนุงูุฌ ุจูุงูุงุช ุฃุฌูุฒุฉ ุงูุงุณุชุดุนุงุฑ ูู ุงููุงุชู:

```
POST /telemetry/push โ TelemetryService::processReading()
```

#### ุญุณุงุจ ุงุญุชูุงููุฉ ุงูุนูู

```
work_probability = 0.4 ร norm(peak_frequency) 
                 + 0.3 ร norm(variance) 
                 + 0.2 ร norm(decibel_level)
                 + 0.1 ร signature_weight
```

#### ุชุตููู ุชูููุน ุงูุญุฑูุฉ

| ุงูุชูููุน | ุงูุดุฑุท |
|---------|-------|
| `mechanical` | ุชุฑุฏุฏ ุนุงูู + ุถูุถุงุก ุนุงููุฉ + ุชุจุงูู ุนุงูู |
| `walking` | ุชุฑุฏุฏ ููุฎูุถ + ุชุจุงูู ูุชูุณุท |
| `stationary` | ูู ุงูููู ููุฎูุถุฉ |
| `suspicious` | ุฃููุงุท ูุชูุงูุถุฉ |

### AnomalyDetector โ ูุดู ุงูุดุฐูุฐ

| ุงูููุน | ุงูุดุฑุท |
|-------|-------|
| `replay_attack` | โฅ 3 ุชูููุนุงุช ูุชุทุงุจูุฉ ูู ุณุงุนุฉ ูุงุญุฏุฉ |
| `impossible_frequency` | ุชุฑุฏุฏ > 20Hz ูุบูุฑ ุงูุขูุงุช |
| `battery_drain` | ูุฌูุงุช ูุจูุฑุฉ (> 30 ุฏูููุฉ) ูู ุงูุจูุงูุงุช |

ุนูุฏ ูุดู ุดุฐูุฐ โ `AnomalyDetected` event โ `PerformanceAlert` ุชุญุฐูุฑู

### ุฅุญุตุงุฆูุงุช ุงูุนูู/ุงูุฑุงุญุฉ (WorkRestStat)

```
productivity_ratio = work_minutes รท (work_minutes + rest_minutes)
```

| ุงูุชูููู | ุงููุณุจุฉ |
|---------|--------|
| ๐ ุฐูุจู | โฅ 80% |
| โ ุนุงุฏู | โฅ 60% |
| โ๏ธ ุชุณุฑูุจ | โฅ 40% |
| ๐ด ุญุฑุฌ | < 40% |

**ุชุณุฑุจ VPM** = ุฏูุงุฆู ุงูุฑุงุญุฉ ร ุชูููุฉ ุงูุฏูููุฉ

---

> **ุงูุณุงุจู**: [ูุธุงู ุงูุญุถูุฑ](07-attendance-system.md) | **ุงูุชุงูู**: [ูุธุงู ุงูุชูุงุตู](09-communication-system.md)

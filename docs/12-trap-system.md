# 12. ูุธุงู ุงููุฎุงุฎ ุงูููุณูุฉ

## 12.1 ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุฃููู ูุฑูุฏ ูุณุชุฎุฏู **ูุฎุงุฎูุง ููุณูุฉ** ูุงูุชุดุงู ุงูุณููููุงุช ุงููุดุจููุฉ. ุงููุฎุงุฎ ุนุจุงุฑุฉ ุนู ุนูุงุตุฑ ูุงุฌูุฉ ููููุฉ (ุฃุฒุฑุงุฑุ ุฑูุงุจุทุ ุตูุญุงุช) ุชุจุฏู ูุบุฑูุฉ ููู ูุญุงูู ุงููุตูู ุบูุฑ ุงููุดุฑูุน.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ุชุฏูู ูุธุงู ุงููุฎุงุฎ                          โ
โ                                                              โ
โ   ๐ฏ ุงููุฎ ูุฒุฑูุน ูู ุงููุงุฌูุฉ (ุดุฑูุท ุฌุงูุจู/ููุญุฉ/ุฅุนุฏุงุฏุงุช)      โ
โ     โ                                                        โ
โ   ๐ค ุงููุณุชุฎุฏู ูุชูุงุนู ูุน ุงููุฎ                                โ
โ     โ                                                        โ
โ   POST /traps/trigger                                        โ
โ     โ                                                        โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ   โ  TrapResponseService::processInteraction โ               โ
โ   โ  1. ุญุณุงุจ ุนุฏุฏ ุงูุชูุงุนูุงุช ุงูุณุงุจูุฉ           โ               โ
โ   โ  2. ุญุณุงุจ ุฏุฑุฌุฉ ุงูุฎุทุฑ (ุฃูุณูู)             โ               โ
โ   โ  3. ุชุญุฏูุฏ ุงูุฅุฌุฑุงุก (ุชุณุฌูู/ุชุญุฐูุฑ/ุชุตุนูุฏ)  โ               โ
โ   โ  4. ุญูุธ TrapInteraction                  โ               โ
โ   โ  5. ุชุณุฌูู ูู AuditLog                   โ               โ
โ   โ  6. ุฅุทูุงู TrapTriggered event           โ               โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ     โ                                                        โ
โ   ๐ ุงููุณุชุฎุฏู ูุฑู ุงุณุชุฌุงุจุฉ ููููุฉ (fake_response)             โ
โ   ๐ ุงูุฅุฏุงุฑุฉ ุชุฑู ุงูุชูุงุนู ูู ุณุฌู ุงูุชุฏููู                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

> โ๏ธ **ุงููุณุชูู 10 ูุนูู**: ูุง ูููุนูู ุงููุฎุงุฎ ุนูุฏ ุชูุงุนูู.

---

## 12.2 ุจููุฉ ุงููุฎ (Trap)

| ุงูุญูู | ุงููุตู | ูุซุงู |
|-------|-------|------|
| `trap_code` | ุฑูุฒ ูุฑูุฏ | `TRAP-SALARY-EXPORT` |
| `name` | ุงุณู ุงููุฎ | "ุชุตุฏูุฑ ูุดูู ุงูุฑูุงุชุจ ุงูุณุฑูุฉ" |
| `description` | ูุตู ุงูุบุฑุถ | โ |
| `trigger_type` | ููุน ุงูุชูุนูู | `button_click`, `page_visit`, `form_submit`, `data_export` |
| `risk_weight` | ูุฒู ุงูุฎุทุฑ (0.1 - 5.0) | 2.5 |
| `placement` | ูููุน ุงูุฒุฑุน | `sidebar`, `dashboard`, `settings`, `toolbar` |
| `target_levels` | JSON โ ุงููุณุชููุงุช ุงููุณุชูุฏูุฉ | `[1,2,3,4,5]` |
| `fake_response` | JSON โ ุงูุงุณุชุฌุงุจุฉ ุงูููููุฉ | `{"message": "ุฌุงุฑู ุงูุชุญููู...", "action": "redirect"}` |
| `is_active` | ูุดุทุ | true |

---

## 12.3 ูุนุงุฏูุฉ ุฏุฑุฌุฉ ุงูุฎุทุฑ

```
risk = min(100, 10 ร 2^(count - 1) ร risk_weight)
```

| ุงูุชูุงุนู # | risk_weight = 1.0 | risk_weight = 2.5 |
|-----------|-------------------|-------------------|
| 1 | 10% | 25% |
| 2 | 20% | 50% |
| 3 | 40% | 100% |
| 4 | 80% | 100% |
| 5 | 100% | 100% |

> **ุชุตุงุนุฏ ุฃูุณูู**: ูู ุชูุงุนู ูุถุงุนู ุงูุฎุทุฑ. ูุฒู ุงูุฎุทุฑ ุงูุนุงูู ููุณุฑูุน ุงููุตูู ููุฐุฑูุฉ.

---

## 12.4 ูุณุชููุงุช ุงูุฅุฌุฑุงุก

| ุฏุฑุฌุฉ ุงูุฎุทุฑ | ุงูุฅุฌุฑุงุก | ุงููุตู |
|------------|---------|-------|
| < 40% | `logged` | ุชุณุฌูู ุตุงูุช ููุท |
| 40-74% | `warned` | ุชุณุฌูู + ุชุญุฐูุฑ ูู ุงูุณุฌู |
| โฅ 75% | `escalated` | ุชุณุฌูู + ุชุตุนูุฏ + ุณุฌู CRITICAL |

### ุนูุฏ ุงูุชุตุนูุฏ (escalated)

```php
// HandleTrapTriggered Listener
Log::channel('daily')->critical('๐จ TRAP ESCALATION', [
    'user'  => $user->name_ar,
    'employee_id' => $user->employee_id,
    'trap'  => $trap->trap_code,
    'risk'  => $interaction->risk_score,
]);
```

---

## 12.5 ุงูุงุณุชุฌุงุจุฉ ุงูููููุฉ (Fake Response)

ูู ูุฎ ููุฑุฌุน ุงุณุชุฌุงุจุฉ ููููุนุฉ ูุง ูุดูู ูููุง ุงููุณุชุฎุฏู:

```json
// ูุซุงู: ูุฎ "ุชุตุฏูุฑ ุจูุงูุงุช ุงูููุธููู"
{
    "message": "ุฌุงุฑู ุชุญุถูุฑ ุงูููู...",
    "action": "loading",
    "delay": 3000
}

// ูุซุงู: ูุฎ "ุตูุญุฉ ุงูุตูุงุญูุงุช ุงููุชูุฏูุฉ"
{
    "message": "ุนุฐุฑูุงุ ูุฐู ุงูููุฒุฉ ููุฏ ุงูุตูุงูุฉ",
    "action": "error"
}
```

---

## 12.6 ุณุฌู ุงูุชูุงุนู (TrapInteraction)

| ุงูุญูู | ุงููุตู |
|-------|-------|
| `trap_id` | ุงููุฎ |
| `user_id` | ุงููุณุชุฎุฏู ุงููุชูุงุนู |
| `risk_score` | ุฏุฑุฌุฉ ุงูุฎุทุฑ (0-100%) |
| `action_taken` | ุงูุฅุฌุฑุงุก (logged/warned/escalated) |
| `interaction_count` | ุฑูู ุงูุชูุงุนู ููุฐุง ุงููุณุชุฎุฏู ูุน ูุฐุง ุงููุฎ |
| `ip_address` | ุนููุงู IP |
| `context_data` | JSON โ ุจูุงูุงุช ุฅุถุงููุฉ (User-Agent, Referrer) |

---

## 12.7 ุตูุญุฉ ุชุฏููู ุงููุฎุงุฎ (TrapAuditPage)

- **ุงููุตูู**: ุงููุณุชูู 10 ููุท
- **ุงููุนุฑูุถ**:
  - ุฅุญุตุงุฆูุงุช ุงููุฎุงุฎ: ุงูุฅุฌูุงููุ ุงููุดุทุฉุ ุงูุชูุงุนูุงุชุ ุงููุตุนูุฏุฉ
  - ุงููุณุชุฎุฏููู ุนุงููู ุงูุฎุทุฑ: ุฃุนูู 10 ุญุณุจ ุฏุฑุฌุฉ ุงูุฎุทุฑ ุงููุตูู
  - ุขุฎุฑ 20 ุชูุงุนู ูุน ุชูุงุตูู

### ุฅุญุตุงุฆูุงุช `TrapResponseService::getStatistics()`

```php
[
    'total_traps'       => 12,
    'active_traps'      => 8,
    'total_interactions' => 156,
    'escalated_count'   => 3,
    'high_risk_count'   => 7,     // risk_score โฅ 75
    'unique_users'      => 23,
    'last_24h_count'    => 5,
    'last_7d_count'     => 28
]
```

### ุงููุณุชุฎุฏููู ุนุงููู ุงูุฎุทุฑ `getHighRiskUsers()`

```php
// ุฃุนูู 10 ูุณุชุฎุฏููู ุญุณุจ max(risk_score)
[
    ['user' => 'ุฃุญูุฏ', 'max_risk' => 100, 'total_interactions' => 5, 'traps_triggered' => 3],
    ['user' => 'ูุญูุฏ', 'max_risk' => 80,  'total_interactions' => 3, 'traps_triggered' => 2],
    ...
]
```

---

## 12.8 ุฃูุซูุฉ ุนูู ูุฎุงุฎ ูุนูุงูุฉ

| ุงููุฎ | ุงููููุน | ุงูุงุณุชูุฏุงู | ุงููุตู |
|------|--------|-----------|-------|
| ุชุตุฏูุฑ ุฑูุงุชุจ VIP | ุดุฑูุท ุฌุงูุจู | ูุณุชูู 3-7 | ุฒุฑ "ุชุตุฏูุฑ ุฑูุงุชุจ ุงูุฅุฏุงุฑุฉ ุงูุนููุง" |
| ููุญุฉ ุตูุงุญูุงุช | ุงูุฅุนุฏุงุฏุงุช | ูุณุชูู 4-6 | ุฑุงุจุท "ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ูุชูุฏูุฉ" |
| ุชูุฑูุฑ ูุงูู ุณุฑู | ููุญุฉ ุงููุนูููุงุช | ูุณุชูู 5-8 | ุจุทุงูุฉ "ุงูุชูุฑูุฑ ุงููุงูู ุงูุณุฑู ุงูุดูุฑู" |
| ุญุฐู ุณุฌูุงุช | ุฃุฏูุงุช | ูุณุชูู 4-9 | ุฒุฑ "ูุณุญ ุณุฌูุงุช ุงูุญุถูุฑ ุงููุฏููุฉ" |

---

> **ุงูุณุงุจู**: [ูุธุงู ุงูุฅุฏุงุฑุฉ ูุงูุชุฏููู](11-management-system.md) | **ุงูุชุงูู**: [ุงูุฃูุงูุฑ ูุงูุฎุฏูุงุช](13-commands-services.md)

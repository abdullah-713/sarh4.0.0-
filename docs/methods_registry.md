# ุตุฑุญ โ ุณุฌู ุงูุฏูุงู ูุงูุฎุฏูุงุช (ุงููุฑุฌุน ุงูุชููู)
> **ุงูุฅุตุฏุงุฑ:** 1.6.0 | **ุขุฎุฑ ุชุญุฏูุซ:** 2026-02-09
> **ุงููุทุงู:** ุชูุซูู ูู ุฏุงูุฉุ ูููุญุตููู ูุญุณูุจุ ููุทุงู ุงุณุชุนูุงูุ ูุซุงุจุชุ ููุนุงุฏูุฉ ุฑูุงุถูุฉ

---

## ููุฑุณ ุงููุญุชููุงุช

1. [ูููุฐุฌ ุงููุณุชุฎุฏู](#1-ูููุฐุฌ-ุงููุณุชุฎุฏู-appmodelsuser)
2. [ูููุฐุฌ ุงููุฑุน](#2-ูููุฐุฌ-ุงููุฑุน-appmodelsbranch)
3. [ูููุฐุฌ ุณุฌู ุงูุญุถูุฑ](#3-ูููุฐุฌ-ุณุฌู-ุงูุญุถูุฑ-appmodelsattendancelog)
4. [ูููุฐุฌ ุงูุชูุฑูุฑ ุงููุงูู](#4-ูููุฐุฌ-ุงูุชูุฑูุฑ-ุงููุงูู-appmodelsfinancialreport)
5. [ูููุฐุฌ ุจูุงุบ ุงููุจูุบูู](#5-ูููุฐุฌ-ุจูุงุบ-ุงููุจูุบูู-appmodelswhistleblowerreport)
6. [ูููุฐุฌ ุงูุฏูุฑ](#6-ูููุฐุฌ-ุงูุฏูุฑ-appmodelsrole)
7. [ูููุฐุฌ ุงูุตูุงุญูุฉ](#7-ูููุฐุฌ-ุงูุตูุงุญูุฉ-appmodelspermission)
8. [ูููุฐุฌ ุงููุณู](#8-ูููุฐุฌ-ุงููุณู-appmodelsdepartment)
9. [ูููุฐุฌ ุงููุญุงุฏุซุฉ](#9-ูููุฐุฌ-ุงููุญุงุฏุซุฉ-appmodelsconversation)
10. [ูููุฐุฌ ุงูุฑุณุงูุฉ](#10-ูููุฐุฌ-ุงูุฑุณุงูุฉ-appmodelsmessage)
11. [ูููุฐุฌ ุงูุชุนููู](#11-ูููุฐุฌ-ุงูุชุนููู-appmodelscircular)
12. [ูููุฐุฌ ุฅูุฑุงุฑ ุงูุชุนููู](#12-ูููุฐุฌ-ุฅูุฑุงุฑ-ุงูุชุนููู)
13. [ูููุฐุฌ ุชูุจูู ุงูุฃุฏุงุก](#13-ูููุฐุฌ-ุชูุจูู-ุงูุฃุฏุงุก)
14. [ูููุฐุฌ ุงูุดุงุฑุฉ](#14-ูููุฐุฌ-ุงูุดุงุฑุฉ-appmodelsbadge)
15. [ูููุฐุฌ ุญุฑูุฉ ุงูููุงุท](#15-ูููุฐุฌ-ุญุฑูุฉ-ุงูููุงุท)
16. [ูููุฐุฌ ุชูุงุนู ุงููุตูุฏุฉ](#16-ูููุฐุฌ-ุชูุงุนู-ุงููุตูุฏุฉ)
17. [ูููุฐุฌ ุทูุจ ุงูุฅุฌุงุฒุฉ](#17-ูููุฐุฌ-ุทูุจ-ุงูุฅุฌุงุฒุฉ)
18. [ูููุฐุฌ ุงูููุงูุจุฉ](#18-ูููุฐุฌ-ุงูููุงูุจุฉ-appmodelsshift)
19. [ูููุฐุฌ ุณุฌู ุงูุชุฏููู](#19-ูููุฐุฌ-ุณุฌู-ุงูุชุฏููู-appmodelsauditlog)
20. [ูููุฐุฌ ุงูุนุทูุฉ](#20-ูููุฐุฌ-ุงูุนุทูุฉ-appmodelsholiday)

---

## 1. ูููุฐุฌ ุงููุณุชุฎุฏู (`App\Models\User`)

**ุงูููู:** `app/Models/User.php`
**ุงูุฌุฏูู:** `users`
**ุงูุณูุงุช:** `HasFactory`, `Notifiable`, `SoftDeletes`

### 1.1 ุงูููุญุตูููุงุช ุงููุญุณูุจุฉ (ุงููุญุฑู ุงููุงูู)

#### `getTotalSalaryAttribute(): float`
- **ุงูุบุฑุถ:** ุญุณุงุจ ุฅุฌูุงูู ุงูุชุนููุถ ุงูุดูุฑู
- **ุงููุนุงุฏูุฉ:** `basic_salary + housing_allowance + transport_allowance + other_allowances`
- **ููุฑุฌุน:** `float` โ ุฅุฌูุงูู ุงูุชุนููุถ ุงูุดูุฑู ุจุงูุฑูุงู ุงูุณุนูุฏู
- **ุงูุงุณุชุฎุฏุงู:** `$user->total_salary`

#### `getMonthlyWorkingMinutesAttribute(): int`
- **ุงูุบุฑุถ:** ุญุณุงุจ ุฅุฌูุงูู ุฏูุงุฆู ุงูุนูู ุงูุดูุฑูุฉ
- **ุงููุนุงุฏูุฉ:** `working_days_per_month ร working_hours_per_day ร 60`
- **ููุฑุฌุน:** `int` โ ุฅุฌูุงูู ุฏูุงุฆู ุงูุนูู ุงููุชุงุญุฉ ูู ุงูุดูุฑ
- **ุงูุงุณุชุฎุฏุงู:** `$user->monthly_working_minutes`
- **ูุซุงู:** `22 ร 8 ร 60 = 10,560 ุฏูููุฉ`

#### `getCostPerMinuteAttribute(): float`
- **ุงูุบุฑุถ:** **ุงููููุงุณ ุงููุงูู ุงูุฃุณุงุณู** โ ุชูููุฉ ูู ุฏูููุฉ ุชุฃุฎูุฑ ููููุธู
- **ุงููุนุงุฏูุฉ:** `basic_salary รท monthly_working_minutes`
- **ุงูุจุฑูุงู ุงูุฑูุงุถู:**
  ```
  ุชูููุฉ_ุงูุฏูููุฉ = ุงูุฑุงุชุจ_ุงูุฃุณุงุณู / (ุฃูุงู_ุงูุนูู_ุงูุดูุฑูุฉ ร ุณุงุนุงุช_ุงูุนูู_ุงูููููุฉ ร 60)

  ููุฑุงุชุจ = 8000 ุฑูุงูุ 22 ูููุ 8 ุณุงุนุงุช:
  ุฏูุงุฆู_ุงูุนูู_ุงูุดูุฑูุฉ = 22 ร 8 ร 60 = 10,560
  ุชูููุฉ_ุงูุฏูููุฉ = 8000 / 10,560 = 0.7576 ุฑูุงู/ุฏูููุฉ (ูููุฑูุจุฉ ูู 4 ููุงุฒู ุนุดุฑูุฉ)
  ```
- **ุงูุญูุงูุฉ:** ุชูุฑุฌุน `0.0` ุฅุฐุง ูุงูุช `monthly_working_minutes <= 0` (ููุน ุงููุณูุฉ ุนูู ุตูุฑ)
- **ููุฑุฌุน:** `float` โ ูููุฑูุจุฉ ูู 4 ููุงุฒู ุนุดุฑูุฉ
- **ุงูุงุณุชุฎุฏุงู:** `$user->cost_per_minute`

#### `getTotalCostPerMinuteAttribute(): float`
- **ุงูุบุฑุถ:** ููุณ ูุง ุณุจู ููู ูุณุชุฎุฏู **ุฅุฌูุงูู ุงูุชุนููุถุงุช** ูููุณ ุงูุฑุงุชุจ ุงูุฃุณุงุณู ููุท
- **ุงููุนุงุฏูุฉ:** `total_salary รท monthly_working_minutes`
- **ููุฑุฌุน:** `float` โ ูููุฑูุจุฉ ูู 4 ููุงุฒู ุนุดุฑูุฉ
- **ุงูุงุณุชุฎุฏุงู:** `$user->total_cost_per_minute`
- **ููุงุญุธุฉ:** ููุณุชุฎุฏู ูู ุงูุชูุงุฑูุฑ ุงูุดุงููุฉุ `cost_per_minute` (ุงูุฃุณุงุณู ููุท) ูู ุงููุนูุงุฑ ูุญุณุงุจ ุชูููุฉ ุงูุชุฃุฎูุฑ

#### `getDailyRateAttribute(): float`
- **ุงูุบุฑุถ:** ุญุณุงุจ ูุนุฏู ุงูุฑุงุชุจ ุงููููู (ููุณุชุฎุฏู ูุชูุฏูุฑ ุชูููุฉ ุงูุฅุฌุงุฒุงุช)
- **ุงููุนุงุฏูุฉ:** `basic_salary รท working_days_per_month`
- **ุงูุญูุงูุฉ:** ุชูุฑุฌุน `0.0` ุฅุฐุง ูุงูุช `working_days_per_month <= 0`
- **ููุฑุฌุน:** `float` โ ูููุฑูุจุฉ ูููุฒูุชูู ุนุดุฑูุชูู
- **ุงูุงุณุชุฎุฏุงู:** `$user->daily_rate`

### 1.2 ุงูููุญุตูููุงุช ุงููุญุณูุจุฉ (ุงูุชุฑุฌูุฉ)

#### `getNameAttribute(): string`
- **ุงูุบุฑุถ:** ุฅุฑุฌุงุน ุงูุงุณู ุงููุญูู ุญุณุจ ูุบุฉ ุงูุชุทุจูู
- **ุงูููุทู:** `app()->getLocale() === 'ar' ? name_ar : name_en`
- **ุงูุงุณุชุฎุฏุงู:** `$user->name`

#### `getJobTitleAttribute(): ?string`
- **ุงูุบุฑุถ:** ุฅุฑุฌุงุน ุงููุณูู ุงููุธููู ุงููุญูู
- **ุงูููุทู:** ููุณ ููุท `getNameAttribute`
- **ุงูุงุณุชุฎุฏุงู:** `$user->job_title`

### 1.3 ุงูุฏูุงู ุงููุงููุฉ

#### `calculateDelayCost(int $minutes): float`
- **ุงูุบุฑุถ:** ุญุณุงุจ ุงูุชูููุฉ ุงููุงููุฉ ูุนุฏุฏ ูุนูู ูู ุฏูุงุฆู ุงูุชุฃุฎูุฑ
- **ุงููุนุงุฏูุฉ:** `$minutes ร cost_per_minute`
- **ุงููุนุงููุงุช:** `$minutes` โ ุนุฏุฏ ุฏูุงุฆู ุงูุชุฃุฎูุฑ
- **ููุฑุฌุน:** `float` โ ูููุฑูุจุฉ ูููุฒูุชูู ุนุดุฑูุชูู
- **ูุซุงู:** `$user->calculateDelayCost(15)` โ `15 ร 0.7576 = 11.36 ุฑูุงู`

### 1.4 ุฏูุงู ุงูุชุญูู ูู ุงููุตูู (RBAC)

#### `hasPermission(string $slug): bool`
- **ุงูุบุฑุถ:** ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูููู ุตูุงุญูุฉ ูุญุฏุฏุฉ ุนุจุฑ ุฏูุฑู
- **ุงูููุทู:** `is_super_admin โ true` (ุชุฌุงูุฒ)ุ ูุฅูุง ูุชุญูู ูู `role.permissions` ูููุทุงุจูุฉ
- **ุงููุนุงููุงุช:** `$slug` โ ูุนุฑูู ุงูุตูุงุญูุฉ (ูุซุงู: `'finance.view_all'`)
- **ููุฑุฌุน:** `bool`

#### `hasSecurityLevel(int $minimumLevel): bool`
- **ุงูุบุฑุถ:** ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุณุชูู ุงูุฃููู ูููุณุชุฎุฏู ูุณุชููู ุงูุญุฏ ุงูุฃุฏูู
- **ุงูููุทู:** `security_level >= $minimumLevel`
- **ุงููุนุงููุงุช:** `$minimumLevel` โ ุนุฏุฏ ุตุญูุญ ูู 1 ุฅูู 10

#### `canManage(User $target): bool`
- **ุงูุบุฑุถ:** ุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุงูุญุงูู ููููู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏู ุงููุณุชูุฏู
- **ุงูููุทู:** `is_super_admin โ true`ุ ูุฅูุง `security_level > target.security_level`
- **ุงูุชุตููู:** ูุณุชุฎุฏู `>` ุตุงุฑูุฉ (ูููุณ `>=`) โ ุงูุฃูุฑุงู ูุง ูููููู ุฅุฏุงุฑุฉ ุจุนุถูู

### 1.5 ุงูุฏูุงู ุงูุฃูููุฉ (ุชุฌุงูุฒ $fillable)

#### `setSecurityLevel(int $level): self`
- **ุงูุบุฑุถ:** ุชุนููู ุงููุณุชูู ุงูุฃููู ูููุณุชุฎุฏู (ุบูุฑ ูุงุจู ููุชุนููู ุงูุฌูุงุนู)
- **ุงูููุทู:** ูุณุชุฎุฏู `forceFill()` ูุชุฌุงูุฒ `$fillable`. ูููููุฏ ุงููููุฉ ุจูู 1-10 ุนุจุฑ `max(1, min($level, 10))`
- **ููุฑุฌุน:** `self` (ูุงุจู ููุชุณูุณู)

#### `promoteToSuperAdmin(): self`
- **ุงูุบุฑุถ:** ููุญ ุตูุงุญูุงุช ุงููุฏูุฑ ุงูุฃุนูู
- **ุงูููุทู:** ูุถุจุท `is_super_admin = true` ู `security_level = 10` ุนุจุฑ `forceFill()`
- **ููุฑุฌุน:** `self` (ูุงุจู ููุชุณูุณู)

#### `enableTrapMonitoring(): self`
- **ุงูุบุฑุถ:** ุชุญุฏูุฏ ุงููุณุชุฎุฏู ููุฑุงูุจุฉ ุงููุตุงุฆุฏ ุงูููุณูุฉ
- **ุงูููุทู:** ูุถุจุท `is_trap_target = true` ุนุจุฑ `forceFill()`
- **ููุฑุฌุน:** `self` (ูุงุจู ููุชุณูุณู)

#### `recordLogin(string $ip): void`
- **ุงูุบุฑุถ:** ุชุณุฌูู ุนูููุฉ ุฏุฎูู ูุงุฌุญุฉ (ูุณุงุฑ ุงูุชุฏููู ุงูุฃููู)
- **ุงูููุทู:** ููุญุฏูุซ `last_login_at`ุ `last_login_ip`ุ ููุตููุฑ `failed_login_attempts` ู `locked_until`

### 1.6 ุงูุฏูุงู ุงูุซุงุจุชุฉ (Static)

#### `generateEmployeeId(): string`
- **ุงูุบุฑุถ:** ุชูููุฏ ุฑูู ุจุทุงูุฉ ููุธู ูุฑูุฏ ุชููุงุฆูุงู
- **ุงูุชูุณูู:** `SARH-{YY}-{0001}` (ูุซุงู: `SARH-26-0042`)
- **ุงูููุทู:** ูุนุฏ ุฌููุน ุงููุณุชุฎุฏููู (ุจูุง ูููู ุงููุญุฐูููู ูุงุนููุงู) + 1ุ ูููููู ุจุฃุตูุงุฑ ูู 4 ุฃุฑูุงู
- **ููุณุชุฏุนู:** ุชููุงุฆูุงู ูู `booted()` ุนุจุฑ ุญุฏุซ `creating`

### 1.7 ูุทุงูุงุช ุงูุงุณุชุนูุงู

| ุงููุทุงู | ุงูุชูููุน | ุงูุชุฃุซูุฑ ุนูู SQL |
|--------|---------|----------------|
| `scopeActive` | `($query)` | `WHERE status = 'active'` |
| `scopeInBranch` | `($query, int $branchId)` | `WHERE branch_id = ?` |
| `scopeInDepartment` | `($query, int $departmentId)` | `WHERE department_id = ?` |
| `scopeWithSecurityLevel` | `($query, int $minLevel)` | `WHERE security_level >= ?` |

### 1.8 ุงูุนูุงูุงุช

| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท | ุงูููุชุงุญ ุงูุฃุฌูุจู/ุงูุฌุฏูู ุงููุณูุท |
|--------|------|-----------------|-------------------------------|
| `branch()` | `BelongsTo` | `Branch` | `branch_id` |
| `department()` | `BelongsTo` | `Department` | `department_id` |
| `role()` | `BelongsTo` | `Role` | `role_id` |
| `directManager()` | `BelongsTo` | `User` | `direct_manager_id` |
| `subordinates()` | `HasMany` | `User` | `direct_manager_id` |
| `attendanceLogs()` | `HasMany` | `AttendanceLog` | `user_id` |
| `financialReports()` | `HasMany` | `FinancialReport` | `user_id` |
| `leaveRequests()` | `HasMany` | `LeaveRequest` | `user_id` |
| `conversations()` | `BelongsToMany` | `Conversation` | `conversation_participants` |
| `sentMessages()` | `HasMany` | `Message` | `sender_id` |
| `performanceAlerts()` | `HasMany` | `PerformanceAlert` | `user_id` |
| `badges()` | `BelongsToMany` | `Badge` | `user_badges` |
| `pointsTransactions()` | `HasMany` | `PointsTransaction` | `user_id` |
| `trapInteractions()` | `HasMany` | `TrapInteraction` | `user_id` |
| `shifts()` | `BelongsToMany` | `Shift` | `user_shifts` |
| `currentShift()` | ุฏุงูุฉ (ููุณุช ุนูุงูุฉ) | `Shift` | ุงูุฌุฏูู ุงููุณูุท `is_current = true` |

### 1.9 ุงูุญููู ุงููุญููุฉ (ููุณุช ุถูู `$fillable`)

| ุงูุญูู | ุณุจุจ ุงูุญูุงูุฉ | ุฏุงูุฉ ุงูุชุนููู |
|-------|-------------|--------------|
| `is_super_admin` | ุตูุงุญูุฉ ุงููุธุงู ุงูููุงุฆูุฉ | `promoteToSuperAdmin()` |
| `security_level` | ูุณุชูู RBAC โ ุตูุงุญูุงุช ูุชุชุงููุฉ | `setSecurityLevel(int)` |
| `is_trap_target` | ูุฑุงูุจุฉ ุงููุฒุงูุฉ ุงูุณุฑูุฉ | `enableTrapMonitoring()` |
| `last_login_at` | ููุฏุงุฑ ุจูุงุณุทุฉ ุงููุธุงู | `recordLogin(string)` |
| `last_login_ip` | ููุฏุงุฑ ุจูุงุณุทุฉ ุงููุธุงู | `recordLogin(string)` |
| `failed_login_attempts` | ููุฏุงุฑ ุจูุงุณุทุฉ ุงููุธุงู | `recordLogin(string)` |
| `locked_until` | ููุฏุงุฑ ุจูุงุณุทุฉ ุงููุธุงู | `recordLogin(string)` |

---

## 2. ูููุฐุฌ ุงููุฑุน (`App\Models\Branch`)

**ุงูููู:** `app/Models/Branch.php`
**ุงูุฌุฏูู:** `branches`

### 2.1 ุฏูุงู ุงูุณูุงุฌ ุงูุฌุบุฑุงูู

#### `distanceTo(float $lat, float $lng): float`
- **ุงูุบุฑุถ:** ุญุณุงุจ ุงููุณุงูุฉ ุจุงูุฃูุชุงุฑ ุจูู ูุฑูุฒ ุงููุฑุน ูุงูุฅุญุฏุงุซูุงุช ุงูููุนุทุงุฉ
- **ุงูุฎูุงุฑุฒููุฉ:** ุตูุบุฉ ูุงูุฑุณุงูู (Haversine)
- **ุงูุจุฑูุงู ุงูุฑูุงุถู:**
  ```
  ูุตู ูุทุฑ ุงูุฃุฑุถ (R) = 6,371,000 ูุชุฑ

  a = sinยฒ(ฮlat/2) + cos(latโ) ร cos(latโ) ร sinยฒ(ฮlng/2)
  c = 2 ร atan2(โa, โ(1-a))
  ุงููุณุงูุฉ = R ร c
  ```
- **ุงููุนุงููุงุช:** `$lat`, `$lng` โ ุฅุญุฏุงุซูุงุช GPS ููููุธู
- **ููุฑุฌุน:** `float` โ ุงููุณุงูุฉ ุจุงูุฃูุชุงุฑุ ูููุฑูุจุฉ ูููุฒูุชูู ุนุดุฑูุชูู

#### `isWithinGeofence(float $lat, float $lng): bool`
- **ุงูุบุฑุถ:** ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุฅุญุฏุงุซูุงุช ุฏุงุฎู ุงูุณูุงุฌ ุงูุฌุบุฑุงูู ูููุฑุน
- **ุงูููุทู:** `distanceTo(lat, lng) <= geofence_radius`
- **ูุตู ุงููุทุฑ ุงูุงูุชุฑุงุถู:** 17 ูุชุฑุงู (ูุงุจู ููุชุฎุตูุต ููู ูุฑุน)

### 2.2 ุงูุฏูุงู ุงููุงููุฉ

#### `recalculateSalaryBudget(): void`
- **ุงูุบุฑุถ:** ุชุญุฏูุซ `monthly_salary_budget` ุงูููุฎุฒูู ูุคูุชุงู ูู ุงูููุธููู ุงููุดุทูู
- **ุงูููุทู:** `SUM(basic_salary) WHERE branch_id = this AND status = 'active'`
- **ููุณุชุฏุนู:** ูุฏููุงู ุฃู ุนุจุฑ ูููุฉ ูุฌุฏููุฉ

### 2.3 ุงูุนูุงูุงุช

| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท |
|--------|------|-----------------|
| `users()` | `HasMany` | `User` |
| `departments()` | `HasMany` | `Department` |
| `attendanceLogs()` | `HasMany` | `AttendanceLog` |
| `financialReports()` | `HasMany` | `FinancialReport` |
| `holidays()` | `HasMany` | `Holiday` |

---

## 3. ูููุฐุฌ ุณุฌู ุงูุญุถูุฑ (`App\Models\AttendanceLog`)

**ุงูููู:** `app/Models/AttendanceLog.php`
**ุงูุฌุฏูู:** `attendance_logs`

### 3.1 ุงูุฏูุงู ุงููุงููุฉ

#### `calculateFinancials(): self`
- **ุงูุบุฑุถ:** ุฃุฎุฐ ููุทุฉ ููุฑูุฉ ูู ุงููุนุฏู ุงููุงูู ููููุธู ูุญุณุงุจ ุฌููุน ุงูุชูุงููู
- **ุงูููุทู:**
  ```php
  cost_per_minute  = user.cost_per_minute  // ููุทุฉ ูู ุงูููุญุตููู
  delay_cost       = delay_minutes ร cost_per_minute
  early_leave_cost = early_leave_minutes ร cost_per_minute
  overtime_value   = overtime_minutes ร cost_per_minute ร 1.5  // ูุนุฏู 1.5x
  ```
- **ููุฑุฌุน:** `self` (ูุงุจู ููุชุณูุณู โ ุงุณุชุฏุนู `->save()` ุจุนุฏู)
- **ุญุฑุฌ:** ูุฌุจ ุงุณุชุฏุนุงุคูุง ุนูุฏ ุชุณุฌูู ุงูุญุถูุฑ ูุฃุฎุฐ ููุทุฉ ูู ูุนุฏู ุงูุฑุงุชุจ ุงูุญุงูู

#### `evaluateAttendance(string $shiftStart, int $gracePeriod = 5): self`
- **ุงูุบุฑุถ:** ุชุญุฏูุฏ ุญุงูุฉ ุงูุญุถูุฑ ูุฏูุงุฆู ุงูุชุฃุฎูุฑ
- **ุงูููุทู:**
  ```
  ุฅุฐุง ูุง ููุฌุฏ check_in_at โ ุงูุญุงูุฉ = 'ุบูุงุจ'
  ูุฅูุง ุฅุฐุง check_in_at โค (ุจุฏุงูุฉ_ุงูููุงูุจุฉ + ูุชุฑุฉ_ุงูุณูุงุญ) โ ุงูุญุงูุฉ = 'ุญุงุถุฑ'ุ ุงูุชุฃุฎูุฑ = 0
  ูุฅูุง โ ุงูุญุงูุฉ = 'ูุชุฃุฎุฑ'ุ ุฏูุงุฆู_ุงูุชุฃุฎูุฑ = ุงููุฑู(check_in_at, ุจุฏุงูุฉ_ุงูููุงูุจุฉ)
  ```
- **ุงููุนุงููุงุช:**
  - `$shiftStart` โ ูุต ุงูููุช ูุซุงู: `'08:00'`
  - `$gracePeriod` โ ุฏูุงุฆู ุงูุณูุงุญ (ุงูุงูุชุฑุงุถู: 5)

### 3.2 ูุทุงูุงุช ุงูุงุณุชุนูุงู

| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeForDate($query, $date)` | `WHERE attendance_date = ?` |
| `scopeLate($query)` | `WHERE status = 'late'` |
| `scopeAbsent($query)` | `WHERE status = 'absent'` |
| `scopeWithDelayCost($query)` | `WHERE delay_cost > 0` |
| `scopeTotalDelayCost($query)` | ุชูุฑุฌุน `SUM(delay_cost)` ูุนุฏุฏ ุนุดุฑู |

### 3.3 ุงูุนูุงูุงุช

| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท |
|--------|------|-----------------|
| `user()` | `BelongsTo` | `User` |
| `branch()` | `BelongsTo` | `Branch` |
| `approvedByUser()` | `BelongsTo` | `User` (ุนุจุฑ `approved_by`) |

---

## 4. ูููุฐุฌ ุงูุชูุฑูุฑ ุงููุงูู (`App\Models\FinancialReport`)

**ุงูููู:** `app/Models/FinancialReport.php`
**ุงูุฌุฏูู:** `financial_reports`

### 4.1 ุฅูุดุงุก ุงูุชูุงุฑูุฑ

#### `static generateForEmployee(User $user, string $start, string $end): self`
- **ุงูุบุฑุถ:** ุจูุงุก ุชูุฑูุฑ ูุงูู ุดุงูู ูููุธู ูุงุญุฏ ุฎูุงู ูุทุงู ุฒููู
- **ุงูููุทู:**
  1. ุงุณุชุนูุงู ุฌููุน `AttendanceLogs` ูููุณุชุฎุฏู ูู ุงููุทุงู ุงูุฒููู
  2. ุชุฌููุน: ุนุฏุฏ ุญุณุจ ุงูุญุงูุฉุ ูุฌุงููุน ุงูุฏูุงุฆู ูุงูุชูุงููู
  3. ุญุณุงุจ `ุตุงูู_ุงูุฃุซุฑ_ุงููุงูู = ุชูููุฉ_ุงูุชุฃุฎูุฑ + ุชูููุฉ_ุงูุฎุฑูุฌ_ุงููุจูุฑ - ุชูููุฉ_ุงูุนูู_ุงูุฅุถุงูู`
  4. ุญุณุงุจ `ูุณุจุฉ_ุงูุฎุณุงุฑุฉ = (ุฅุฌูุงูู_ุชูููุฉ_ุงูุชุฃุฎูุฑ / ููุฒุงููุฉ_ุงูุฑูุงุชุจ) ร 100`
- **ููุฑุฌุน:** ูุซูู `FinancialReport` ุบูุฑ ูุญููุธ (ุงุณุชุฏุนู `->save()` ููุญูุธ)
- **ููุงุญุธุฉ:** `report_code` ูููุดุฃ ุชููุงุฆูุงู ูู `FIN-EMP-{employee_id}-{timestamp}`

#### `static generateReportCode(string $scope): string`
- **ุงูุบุฑุถ:** ุชูููุฏ ูุนุฑูู ุชูุฑูุฑ ูุฑูุฏ
- **ุงูุชูุณูู:** `FIN-{PREFIX_ุงููุทุงู}-{YmdHis}-{3_ุฃุฑูุงู_ุนุดูุงุฆูุฉ}`
- **ูุซุงู:** `FIN-BRA-20260207143022-042`

### 4.2 ูุทุงูุงุช ุงูุงุณุชุนูุงู

| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeForPeriod($query, $start, $end)` | `WHERE period_start BETWEEN ? AND ?` |
| `scopeByScope($query, $scope)` | `WHERE scope = ?` |

### 4.3 ุงูุนูุงูุงุช

| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท |
|--------|------|-----------------|
| `user()` | `BelongsTo` | `User` |
| `branch()` | `BelongsTo` | `Branch` |
| `department()` | `BelongsTo` | `Department` |
| `generatedByUser()` | `BelongsTo` | `User` (ุนุจุฑ `generated_by`) |

---

## 5. ูููุฐุฌ ุจูุงุบ ุงููุจูุบูู (`App\Models\WhistleblowerReport`)

**ุงูููู:** `app/Models/WhistleblowerReport.php`

### 5.1 ุฏูุงู ุงูุชุดููุฑ

#### `setContent(string $plainText): self`
- **ุงูุบุฑุถ:** ุชุดููุฑ ูุชุฎุฒูู ูุต ุงูุจูุงุบ
- **ุงูููุทู:** `encrypted_content = encrypt($plainText)` (ุชุดููุฑ Laravel AES-256-CBC)

#### `getContent(): string`
- **ุงูุบุฑุถ:** ูู ุชุดููุฑ ูุฅุฑุฌุงุน ูุต ุงูุจูุงุบ
- **ุงูููุทู:** `decrypt($this->encrypted_content)`

### 5.2 ุงูุฏูุงู ุงูุซุงุจุชุฉ

#### `static generateTicketNumber(): string`
- **ุงูุชูุณูู:** `WB-{8_ุฃุญุฑู_ุณุช_ุนุดุฑูุฉ}-{yymmdd}`
- **ูุซุงู:** `WB-A3F1B2C4-260207`

#### `static generateAnonymousToken(): string`
- **ุงูุฎูุงุฑุฒููุฉ:** `SHA-256(random_bytes(32) + microtime)`
- **ุงูุบุฑุถ:** ุฑูุฒ ููุดููุฑ ูููุชุงุจุนุฉ ุงููุฌูููุฉ

---

## 6. ูููุฐุฌ ุงูุฏูุฑ (`App\Models\Role`)

### 6.1 ุงูุฏูุงู

| ุงูุฏุงูุฉ | ุงูุชูููุน | ุงูุบุฑุถ |
|--------|---------|-------|
| `grantPermission` | `(Permission $permission): void` | ุฅุถุงูุฉ ุตูุงุญูุฉ ุนุจุฑ `syncWithoutDetaching` |
| `revokePermission` | `(Permission $permission): void` | ุฅุฒุงูุฉ ุตูุงุญูุฉ ุนุจุฑ `detach` |
| `hasPermission` | `(string $slug): bool` | ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฏูุฑ ูููู ุตูุงุญูุฉ ูุญุฏุฏุฉ |

---

## 7. ูููุฐุฌ ุงูุตูุงุญูุฉ (`App\Models\Permission`)

### 7.1 ุงููุทุงูุงุช

| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeInGroup($query, string $group)` | `WHERE group = ?` |

---

## 8. ูููุฐุฌ ุงููุณู (`App\Models\Department`)

### 8.1 ุงูุนูุงูุงุช

| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท |
|--------|------|-----------------|
| `branch()` | `BelongsTo` | `Branch` |
| `parent()` | `BelongsTo` | `Department` (ุฐุงุชู) |
| `children()` | `HasMany` | `Department` (ุฐุงุชู) |
| `head()` | `BelongsTo` | `User` (ุนุจุฑ `head_id`) |
| `users()` | `HasMany` | `User` |
| `financialReports()` | `HasMany` | `FinancialReport` |

---

## 9-12. ููุงุฐุฌ ุงููุฑุงุณูุงุช

### ุงููุญุงุฏุซุฉ (Conversation)

| ุงูุฏุงูุฉ | ุงูููุน | ุงููุฑุชุจุท |
|--------|------|---------|
| `creator()` | `BelongsTo` | `User` (ุนุจุฑ `created_by`) |
| `participants()` | `BelongsToMany` | `User` (ุงูุฌุฏูู ุงููุณูุท: `conversation_participants`) |
| `messages()` | `HasMany` | `Message` |
| `latestMessage()` | `HasOne` | `Message` (`latestOfMany`) |

### ุงูุฑุณุงูุฉ (Message)
| ุงูุฏุงูุฉ | ุงูููุน | ุงููุฑุชุจุท |
|--------|------|---------|
| `conversation()` | `BelongsTo` | `Conversation` |
| `sender()` | `BelongsTo` | `User` (ุนุจุฑ `sender_id`) |

### ุงูุชุนููู (Circular)
| ุงูุฏุงูุฉ | ุงูููุน | ุงููุฑุชุจุท |
|--------|------|---------|
| `creator()` | `BelongsTo` | `User` (ุนุจุฑ `created_by`) |
| `targetBranch()` | `BelongsTo` | `Branch` |
| `targetDepartment()` | `BelongsTo` | `Department` |
| `targetRole()` | `BelongsTo` | `Role` |
| `acknowledgments()` | `HasMany` | `CircularAcknowledgment` |

**ุงููุทุงูุงุช:** `scopePublished`ุ `scopeActive` (ููุดูุฑ + ุบูุฑ ููุชูู ุงูุตูุงุญูุฉ)

---

## 13. ูููุฐุฌ ุชูุจูู ุงูุฃุฏุงุก (PerformanceAlert)

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeUnread($query)` | `WHERE is_read = false` |
| `scopeCritical($query)` | `WHERE severity = 'critical'` |

---

## 14. ูููุฐุฌ ุงูุดุงุฑุฉ (`App\Models\Badge`)

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeActive($query)` | `WHERE is_active = true` |
| `scopeByCategory($query, string $category)` | `WHERE category = ?` |

---

## 15. ูููุฐุฌ ุญุฑูุฉ ุงูููุงุท (PointsTransaction)

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeEarned($query)` | `WHERE type = 'earned'` |
| `scopeDeducted($query)` | `WHERE type = 'deducted'` |

### ุงูุนูุงูุฉ ูุชุนุฏุฏุฉ ุงูุฃุดูุงู
- `sourceable()` โ `MorphTo` โ ุฃู ูููุฐุฌ ูููู ุฃู ูููู ูุตุฏุฑ ุงูููุงุท

---

## 16. ูููุฐุฌ ุชูุงุนู ุงููุตูุฏุฉ (TrapInteraction)

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeUnreviewed($query)` | `WHERE is_reviewed = false` |
| `scopeHighRisk($query)` | `WHERE risk_level IN ('high', 'critical')` |

---

## 17. ูููุฐุฌ ุทูุจ ุงูุฅุฌุงุฒุฉ (LeaveRequest)

#### `calculateCost(): self`
- **ุงูุบุฑุถ:** ุชูุฏูุฑ ุชูููุฉ ุงูุฅุฌุงุฒุฉ ุจูุงุกู ุนูู ุงููุนุฏู ุงููููู
- **ุงููุนุงุฏูุฉ:** `ุฅุฌูุงูู_ุงูุฃูุงู ร user.daily_rate`

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopePending($query)` | `WHERE status = 'pending'` |
| `scopeApproved($query)` | `WHERE status = 'approved'` |

---

## 18. ูููุฐุฌ ุงูููุงูุจุฉ (`App\Models\Shift`)

#### `getDurationMinutesAttribute(): int`
- **ุงูุบุฑุถ:** ุญุณุงุจ ูุฏุฉ ุงูููุงูุจุฉ ุจุงูุฏูุงุฆู
- **ุงูููุทู:** ูุชุนุงูู ูุน ุงูููุงูุจุงุช ุงูููููุฉ (ุงูููุงูุฉ < ุงูุจุฏุงูุฉ โ ุฅุถุงูุฉ 24 ุณุงุนุฉ)
- **ุงูุงุณุชุฎุฏุงู:** `$shift->duration_minutes`

---

## 19. ูููุฐุฌ ุณุฌู ุงูุชุฏููู (`App\Models\AuditLog`)

#### `static record(string $action, ?Model $model, ?array $old, ?array $new, ?string $description): self`
- **ุงูุบุฑุถ:** ูุณุงุนุฏ ุชุณุฌูู ุณุฑูุน โ ููุชูุท ุงููุณุชุฎุฏู ูุนููุงู IP ููุนุฑูู ุงููุชุตูุญ ุชููุงุฆูุงู
- **ุงูุงุณุชุฎุฏุงู:** `AuditLog::record('update', $user, $oldData, $newData, 'ุชู ุชุบููุฑ ุงูุฑุงุชุจ')`

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeForModel($query, string $type, int $id)` | ุงูุชุตููุฉ ุญุณุจ ุงููุฏู ูุชุนุฏุฏ ุงูุฃุดูุงู |
| `scopeByAction($query, string $action)` | `WHERE action = ?` |

---

## 20. ูููุฐุฌ ุงูุนุทูุฉ (`App\Models\Holiday`)

#### `static isHoliday(Carbon $date, ?int $branchId = null): bool`
- **ุงูุบุฑุถ:** ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุชุงุฑูุฎ ูุนูู ุนุทูุฉ (ุนุงูุฉ ุฃู ููุฑุน ูุญุฏุฏ)
- **ุงูููุทู:** ูุชุญูู ูู `WHERE date = ? AND (branch_id IS NULL OR branch_id = ?)`

---

## 21. ุฎุฏูุฉ ุงูุณูุงุฌ ุงูุฌุบุฑุงูู (`App\Services\GeofencingService`)

**ุงูููู:** `app/Services/GeofencingService.php`

#### `validatePosition(Branch $branch, float $lat, float $lng): array`
- **ุงูุบุฑุถ:** ุงูุชุญูู ูู ุฅุญุฏุงุซูุงุช GPS ููุงุจู ุงูุณูุงุฌ ุงูุฌุบุฑุงูู ูููุฑุน
- **ููุฑุฌุน:** `['distance_meters' => float, 'within_geofence' => bool]`
- **ุงูููุทู:** ูููููุถ ุฅูู `Branch::distanceTo()` ู `Branch::isWithinGeofence()`
- **ูุซุงู:** `$result = $service->validatePosition($branch, 24.7136, 46.6753)`

#### `static haversineDistance(float $lat1, float $lng1, float $lat2, float $lng2): float`
- **ุงูุบุฑุถ:** ุฃุฏุงุฉ ุซุงุจุชุฉ ูุญุณุงุจ ูุณุงูุฉ ูุงูุฑุณุงูู (ุจุงูุฃูุชุงุฑ)
- **ุงูุฎูุงุฑุฒููุฉ:** ููุณ `Branch::distanceTo()` ููู ุจุฏูู ุญุงูุฉ
- **ููุฑุฌุน:** `float` โ ุฃูุชุงุฑุ ูููุฑูุจุฉ ูููุฒูุชูู ุนุดุฑูุชูู

---

## 22. ุฎุฏูุฉ ุงูุญุถูุฑ (`App\Services\AttendanceService`)

**ุงูููู:** `app/Services/AttendanceService.php`

#### `checkIn(User $user, float $lat, float $lng, ?string $ip, ?string $device): AttendanceLog`
- **ุงูุบุฑุถ:** ุณูุฑ ุนูููุฉ ุชุณุฌูู ุงูุญุถูุฑ ุงููุงูู ูุน ุงูุณูุงุฌ ุงูุฌุบุฑุงูู + ุงูููุทุฉ ุงููุงููุฉ
- **ุงูุฎุทูุงุช:**
  1. ุชุญููู ูุฑุน ุงููุณุชุฎุฏู (`$user->branch`)
  2. ุงูุชุญูู ูู ุงูุณูุงุฌ ุนุจุฑ `GeofencingService::validatePosition()`
  3. ุงูุฑูุถ ุฅุฐุง ุฎุงุฑุฌ ุงูุณูุงุฌ (ูุฑูู `OutOfGeofenceException`)
  4. ุชุญุฏูุฏ ุงูููุงูุจุฉ ุนุจุฑ `$user->currentShift()` ุฃู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ูููุฑุน
  5. ุฅูุดุงุก `AttendanceLog` ุจุจูุงูุงุช GPS
  6. ุงุณุชุฏุนุงุก `evaluateAttendance(shift_start, grace_period)` โ ุชุญุฏูุฏ ุงูุญุงูุฉ + ุงูุชุฃุฎูุฑ
  7. ุงุณุชุฏุนุงุก `calculateFinancials()` โ ุฃุฎุฐ ููุทุฉ ุชูููุฉ_ุงูุฏูููุฉ + ุญุณุงุจ ุงูุชูุงููู
  8. ุงูุญูุธ ูุงูุฅุฑุฌุงุน
- **ูุฑูู:** `OutOfGeofenceException` ุฅุฐุง ูุงู `within_geofence === false`
- **ููุฑุฌุน:** ูุซูู `AttendanceLog` ูุญููุธ

#### `checkOut(User $user, float $lat, float $lng): AttendanceLog`
- **ุงูุบุฑุถ:** ุณูุฑ ุนูููุฉ ุชุณุฌูู ุงูุงูุตุฑุงู ุงููุงูู ูุน ุญุณุงุจ ุงูุนูู ุงูุฅุถุงูู/ุงูุฎุฑูุฌ ุงููุจูุฑ
- **ุงูุฎุทูุงุช:**
  1. ุงูุจุญุซ ุนู `AttendanceLog` ุงูููู ูููุณุชุฎุฏู
  2. ุงูุชุญูู ูู ุงูุณูุงุฌ ูุฅุญุฏุงุซูุงุช ุงูุงูุตุฑุงู
  3. ุญุณุงุจ `worked_minutes` ูู ูุฑู ุงูุญุถูุฑ/ุงูุงูุตุฑุงู
  4. ุงูููุงุฑูุฉ ูุน ูุฏุฉ ุงูููุงูุจุฉ โ ุนูู ุฅุถุงูู ุฃู ุฎุฑูุฌ ูุจูุฑ
  5. ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุจูุงูุงุช ุงููุงููุฉ
  6. ุงูุญูุธ ูุงูุฅุฑุฌุงุน
- **ูุฑูู:** `ModelNotFoundException` ุฅุฐุง ูู ููู ููุงู ุชุณุฌูู ุญุถูุฑ ููููู
- **ููุฑุฌุน:** ูุซูู `AttendanceLog` ููุญุฏูุซ

#### `calculateDelayCost(User $user, int $minutesDelayed): float`
- **ุงูุบุฑุถ:** ุบูุงู ูู `User::calculateDelayCost()` โ ูุชุงุญ ูุฏุงูุฉ ุฎุฏููุฉ
- **ุงููุนุงุฏูุฉ:** `(ุงูุฑุงุชุจ_ุงูุฃุณุงุณู / ุฃูุงู_ุงูุนูู / ุณุงุนุงุช_ุงูุนูู / 60) ร ุฏูุงุฆู_ุงูุชุฃุฎูุฑ`
- **ููุฑุฌุน:** `float` โ ูููุฑูุจุฉ ูููุฒูุชูู ุนุดุฑูุชูู

---

## 23. ูุชุญูู ุงูุญุถูุฑ (`App\Http\Controllers\AttendanceController`)

**ุงูููู:** `app/Http/Controllers/AttendanceController.php`

#### `checkIn(Request $request): JsonResponse`
- **ุงููุณุงุฑ:** `POST /attendance/check-in`
- **ุงูุชุญูู:** `latitude` (ูุทููุจุ ุฑูููุ -90..90)ุ `longitude` (ูุทููุจุ ุฑูููุ -180..180)
- **ุงููุตุงุฏูุฉ:** ูุณุชุฎุฏู ููุตุงุฏู ุนููู (ูุณูุท `auth`)
- **ููุฑุฌุน:** `201` ูุน JSON ูู AttendanceLog ุฃู `422` ุฅุฐุง ุฎุงุฑุฌ ุงูุณูุงุฌ

#### `checkOut(Request $request): JsonResponse`
- **ุงููุณุงุฑ:** `POST /attendance/check-out`
- **ุงูุชุญูู:** ููุณ ุญููู GPS
- **ููุฑุฌุน:** `200` ูุน JSON ูู AttendanceLog ุงูููุญุฏูุซ

#### `todayStatus(Request $request): JsonResponse`
- **ุงููุณุงุฑ:** `GET /attendance/today`
- **ููุฑุฌุน:** ุณุฌู ุญุถูุฑ ุงูููู ุฃู `null` ุฅุฐุง ูู ููุณุฌูู ุงูุญุถูุฑ

---

## 24. ูููุฐุฌ ุงููุตูุฏุฉ (`App\Models\Trap`)

**ุงูููู:** `app/Models/Trap.php`
**ุงูุฌุฏูู:** `traps`

#### `getNameAttribute(): string`
- **ุงูุบุฑุถ:** ุฅุฑุฌุงุน ุงุณู ุงููุตูุฏุฉ ุงููุญูู
- **ุงูููุทู:** `app()->getLocale() === 'ar' ? name_ar : name_en`

#### `deriveRiskLevel(): string`
- **ุงูุบุฑุถ:** ุชุญููู `risk_weight` (1-10) ุฅูู ูุณุชูู ุฎุทูุฑุฉ ููุฑูุก
- **ุงูููุทู:**
  ```
  1-3  โ 'ููุฎูุถ' (low)
  4-6  โ 'ูุชูุณุท' (medium)
  7-8  โ 'ูุฑุชูุน' (high)
  9-10 โ 'ุญุฑุฌ' (critical)
  ```
- **ููุฑุฌุน:** `string` โ ุฅุญุฏู ุงูููู: `low`ุ `medium`ุ `high`ุ `critical`

### ุงููุทุงูุงุช
| ุงููุทุงู | ุงูุชุฃุซูุฑ |
|--------|---------|
| `scopeActive($query)` | `WHERE is_active = true` |
| `scopeByCode($query, string $code)` | `WHERE trap_code = ?` |

### ุงูุนูุงูุงุช
| ุงูุฏุงูุฉ | ุงูููุน | ุงููููุฐุฌ ุงููุฑุชุจุท |
|--------|------|-----------------|
| `interactions()` | `HasMany` | `TrapInteraction` |

---

## 25. ูููุฐุฌ ุงููุณุชุฎุฏู โ ุฅุถุงูุงุช ุชูููู ูุฎุงุทุฑ ุงููุตุงุฆุฏ

### ุฏูุงู ุชุณุฌูู ุงููุฎุงุทุฑ

#### `incrementRiskScore(): int`
- **ุงูุบุฑุถ:** ุญุณุงุจ ูุญูุธ ุฏุฑุฌุฉ ุงููุฎุงุทุฑ ุงูููุบุงุฑูุชููุฉ ุจุนุฏ ุชูุงุนู ูุน ูุตูุฏุฉ
- **ุงููุนุงุฏูุฉ:** `risk_score = 10 ร (2^n โ 1)` ุญูุซ `n` = ุฅุฌูุงูู ุนุฏุฏ ุชูุงุนูุงุช ุงููุตุงุฆุฏ
- **ุงูุจุฑูุงู ุงูุฑูุงุถู:**
  ```
  n=1: 10 ร (2ยน โ 1) =   10
  n=2: 10 ร (2ยฒ โ 1) =   30
  n=3: 10 ร (2ยณ โ 1) =   70
  n=4: 10 ร (2โด โ 1) =  150
  n=5: 10 ร (2โต โ 1) =  310
  ```
- **ุงูุญูุธ:** ูุณุชุฎุฏู `forceFill()` โ `risk_score` ููุณ ุถูู `$fillable`
- **ููุฑุฌุน:** `int` โ ุฏุฑุฌุฉ ุงููุฎุงุทุฑ ุงูุฌุฏูุฏุฉ

#### `getRiskLevelAttribute(): string`
- **ุงูุบุฑุถ:** ุชุตููู ูุฎุงุทุฑ ููุฑูุก ุจูุงุกู ุนูู ุงูุฏุฑุฌุฉ ุงูุชุฑุงูููุฉ
- **ุงูููุทู:**
  ```
  ุงูุฏุฑุฌุฉ < 30   โ 'ููุฎูุถ' (low)
  ุงูุฏุฑุฌุฉ < 100  โ 'ูุชูุณุท' (medium)
  ุงูุฏุฑุฌุฉ < 300  โ 'ูุฑุชูุน' (high)
  ุงูุฏุฑุฌุฉ >= 300 โ 'ุญุฑุฌ' (critical)
  ```

---

## 26. ุฎุฏูุฉ ุงุณุชุฌุงุจุฉ ุงููุตุงุฆุฏ (`App\Services\TrapResponseService`)

**ุงูููู:** `app/Services/TrapResponseService.php`

#### `triggerTrap(User $user, string $trapCode, Request $request): array`
- **ุงูุบุฑุถ:** ุณูุฑ ุนูููุฉ ุชูุนูู ุงููุตูุฏุฉ ุงููุงูู: ุชุณุฌูู ุงูุชูุงุนู โ ุฒูุงุฏุฉ ุงููุฎุงุทุฑ โ ุฅูุดุงุก ุงุณุชุฌุงุจุฉ ููููุฉ
- **ุงูุฎุทูุงุช:**
  1. ุชุญุฏูุฏ `Trap` ุจูุงุณุทุฉ `trap_code`
  2. ุฅูุดุงุก ุณุฌู `TrapInteraction` ูุน IP ููุนุฑูู ุงููุชุตูุญ ูุงูุจูุงูุงุช ุงููุตููุฉ
  3. ุงุณุชุฏุนุงุก `User::incrementRiskScore()`
  4. ุงุณุชุฏุนุงุก `generateFakeResponse()` ูููุน ุงููุตูุฏุฉ
- **ููุฑุฌุน:** `array` โ ุญูููุฉ ุงูุงุณุชุฌุงุจุฉ ุงูููููุฉ ูุนุฑุถูุง ูู ุชุทุจูู PWA
- **ูุฑูู:** `ModelNotFoundException` ุฅุฐุง ูุงู trap_code ุบูุฑ ุตุงูุญ

#### `generateFakeResponse(Trap $trap): array`
- **ุงูุบุฑุถ:** ุฅูุชุงุฌ ุชุนูููุงุช ูุงุฌูุฉ ููููุนุฉ ููููุฉ ููู ููุน ูุตูุฏุฉ
- **ููุฑุฌุน:** ูุตูููุฉ ููุชุงุญูุฉ ูุน ุงุณุชุฌุงุจุฉ ุฎุงุตุฉ ุจููุน ุงููุตูุฏุฉ:
  ```php
  // ุงุณุชุฑุงู ุงููุธุฑ ุนูู ุงูุฑูุงุชุจ (SALARY_PEEK)
  ['type' => 'table', 'data' => [...ุตููู ุฑูุงุชุจ ููููุฉ...]]

  // ุชุตุนูุฏ ุงูุตูุงุญูุงุช (PRIVILEGE_ESCALATION)
  ['type' => 'success', 'message' => 'ุชู ููุญ ูุตูู ูุคูุช ููุฏูุฑ']

  // ุชุฌุงูุฒ ุงููุธุงู (SYSTEM_BYPASS)
  ['type' => 'warning', 'message' => 'ุชู ุฅููุงู ูุธุงู ุงูุญุถูุฑ ููุฏุฉ 24 ุณุงุนุฉ']

  // ุชุตุฏูุฑ ุงูุจูุงูุงุช (DATA_EXPORT)
  ['type' => 'download', 'progress' => 100, 'url' => '/exports/fake_...csv']
  ```

---

## 27. ูุชุญูู ุงููุตุงุฆุฏ (`App\Http\Controllers\TrapController`)

**ุงูููู:** `app/Http/Controllers/TrapController.php`

#### `trigger(Request $request): JsonResponse`
- **ุงููุณุงุฑ:** `POST /traps/trigger`
- **ุงูุชุญูู:** `trap_code` (ูุทููุจุ ููุฌูุฏ ูู:traps,trap_code)
- **ุงููุตุงุฏูุฉ:** ูุณุชุฎุฏู ููุตุงุฏู ุนููู
- **ููุฑุฌุน:** `200` ูุน ุญูููุฉ ุงูุงุณุชุฌุงุจุฉ ุงูููููุฉ

---

## 28. ููููุงุช Livewire โ ุชุทุจูู ุงูููุธู (PWA)

### ููุญุฉ ุชุญูู ุงูููุธู (`App\Livewire\EmployeeDashboard`)
- **ุงูุชุญููู:** ููุญููู ุงููุณุชุฎุฏู ุงูููุตุงุฏู ุนููู ูุน ุงูุนูุงูุงุช
- **ุงูุนุฑุถ:** `livewire.employee-dashboard` โ ุญุงููุฉ ูุฌููุน ุงููุฏุฌุงุช ุงูุฃุฑุจุน

### ูุฏุฌุฉ ุงูุญุถูุฑ (`App\Livewire\AttendanceWidget`)
- **ุงูุบุฑุถ:** ุนุฑุถ ุญุงูุฉ ุงูุญุถูุฑ ุงููููู ูุน ุชุณุฌูู ุงูุญุถูุฑ/ุงูุงูุตุฑุงู ุนุจุฑ GPS
- **ุงูุฎุตุงุฆุต:** `$status`ุ `$checkInTime`ุ `$checkOutTime`
- **ุงูุฏูุงู:**
  - `checkIn()` โ ุชุณุชุฏุนู AttendanceService ูุน ุงููููุน ุงูุฌุบุฑุงูู
  - `checkOut()` โ ุชุณุชุฏุนู AttendanceService ูุชุณุฌูู ุงูุงูุตุฑุงู

### ูุฏุฌุฉ ุงูุชูููู (`App\Livewire\GamificationWidget`)
- **ุงูุบุฑุถ:** ุนุฑุถ ุงูููุงุท ูุงูุณูุณูุฉ ุงูุญุงููุฉ ูุงูุดุงุฑุงุช ุงูููุชุณุจุฉ
- **ุงูุฎุตุงุฆุต:** `$totalPoints`ุ `$currentStreak`ุ `$badges`

### ุงููุฏุฌุฉ ุงููุงููุฉ (`App\Livewire\FinancialWidget`)
- **ุงูุบุฑุถ:** ุนุฑุถ "ุฏุฑุฌุฉ ุงูุงูุถุจุงุท" โ ุชุฃุซูุฑ ุชูููุฉ ุงูุชุฃุฎูุฑ
- **ุงูุฎุตุงุฆุต:** `$delayCost`ุ `$onTimeRate`ุ `$monthlyLogs`

### ูุฏุฌุฉ ุงูุชุนุงููู (`App\Livewire\CircularsWidget`)
- **ุงูุบุฑุถ:** ุนุฑุถ ูุงุฆูุฉ ุงูุชุนุงููู ุงููุดุทุฉ ูุน ุญุงูุฉ ุงูุฅูุฑุงุฑ
- **ุงูุฏูุงู:**
  - `acknowledge(int $circularId)` โ ุชููุดุฆ ุณุฌู CircularAcknowledgment

---

## 29. ููููุงุช Livewire โ ูุธุงู ุงูุจูุงุบุงุช ุงูุณุฑูุฉ

### ูููุฐุฌ ุงูุจูุงุบ ุงูุณุฑู (`App\Livewire\WhistleblowerForm`)
- **ุงูุบุฑุถ:** ุชูุฏูู ุจูุงุบ ูุดููุฑ ูุฌููู
- **ุงูุฎุตุงุฆุต:** `$category`ุ `$severity`ุ `$content`
- **ุงูุฏูุงู:**
  - `submit()` โ ุชูุดููุฑ ุงููุญุชููุ ุชููุดุฆ ุฑูู ุชุฐูุฑุฉ + ุฑูุฒ ูุฌูููุ ุชุญูุธ ุงูุจูุงุบ
  - ุชูุฑุฌุน ticket_number + anonymous_token (ุชูุนุฑุถ ูุฑุฉ ูุงุญุฏุฉ ููุท)
- **ุงูุฃูุงู:** ูุง ุชุชุทูุจ ูุตุงุฏูุฉ. ูุง ููุฎุฒูู ููุชุงุญ ุฃุฌูุจู ูููุณุชุฎุฏู.

### ุชุชุจุน ุงูุจูุงุบ (`App\Livewire\WhistleblowerTrack`)
- **ุงูุบุฑุถ:** ุชุชุจุน ุญุงูุฉ ุงูุจูุงุบ ุจุงูุฑูุฒ ุงููุฌููู
- **ุงูุฎุตุงุฆุต:** `$token`ุ `$report`
- **ุงูุฏูุงู:**
  - `track()` โ ูุจุญุซ ุนู ุงูุจูุงุบ ุจูุงุณุทุฉ anonymous_tokenุ ูุนุฑุถ ุงูุญุงูุฉ (ุจุฏูู ุงููุญุชูู)

---

## 30. ููููุงุช Livewire โ ุงููุฑุงุณูุงุช

### ุตูุฏูู ุงููุงุฑุฏ (`App\Livewire\MessagingInbox`)
- **ุงูุบุฑุถ:** ุนุฑุถ ูุงุฆูุฉ ุฌููุน ุงููุญุงุฏุซุงุช ูุน ูุนุงููุฉ ุขุฎุฑ ุฑุณุงูุฉ
- **ุงูุฎุตุงุฆุต:** `$conversations`ุ `$unreadCount`
- **ุงูุชุญุฏูุซ ุงูุฏูุฑู:** ุชุญุฏูุซ ูู 5 ุซูุงูู ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ

### ุงููุญุงุฏุซุฉ (`App\Livewire\MessagingChat`)
- **ุงูุบุฑุถ:** ุนุฑุถ ูุญุงุฏุซุฉ ูุงุญุฏุฉ ูุน ููุงุนุงุช ุงูุฑุณุงุฆู
- **ุงูุฎุตุงุฆุต:** `$conversation`ุ `$messages`ุ `$newMessage`
- **ุงูุฏูุงู:**
  - `sendMessage()` โ ุชููุดุฆ ุณุฌู ุฑุณุงูุฉุ ุชูุญุฏูุฏ ุฑุณุงุฆู ุงูููุฑุณู ูููุฑูุกุฉ
  - `markAsRead()` โ ุชูุญุฏูุซ ุญุงูุฉ ุงููุฑุงุกุฉ ุนูุฏ ุงูุชุญููู + ุงูุชุญุฏูุซ
- **ุงูุชุญุฏูุซ ุงูุฏูุฑู:** ุชุญุฏูุซ ูู 3 ุซูุงูู ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ

---

## 31. ูุชุญููุงุช ููุณุงุฑุงุช ุชุทุจูู PWA

### ูุชุญูู ููุญุฉ ุงูุชุญูู (`App\Http\Controllers\DashboardController`)
- **ุงููุณุงุฑ:** `GET /dashboard` โ ููุญุฉ ุชุญูู ุงูููุธู
- **ุงููุตุงุฏูุฉ:** ูุทููุจุฉ (ูุณูุท `auth`)

### ูุชุญูู ุงูุจูุงุบุงุช ุงูุณุฑูุฉ (`App\Http\Controllers\WhistleblowerController`)
- **ุงููุณุงุฑุงุช:**
  - `GET /whistleblower` โ ูููุฐุฌ ุงูุจูุงุบ ุงููุฌููู (ุจุฏูู ูุตุงุฏูุฉ)
  - `GET /whistleblower/track` โ ุชุชุจุน ุงูุจูุงุบ ุจุงูุฑูุฒ (ุจุฏูู ูุตุงุฏูุฉ)

### ูุชุญูู ุงููุฑุงุณูุงุช (`App\Http\Controllers\MessagingController`)
- **ุงููุณุงุฑุงุช:**
  - `GET /messaging` โ ุตูุฏูู ุงููุงุฑุฏ (ูุตุงุฏูุฉ ูุทููุจุฉ)
  - `GET /messaging/{conversation}` โ ุนุฑุถ ุงููุญุงุฏุซุฉ (ูุตุงุฏูุฉ ูุทููุจุฉ)

---

---

## ยง32. ุฎุฏูุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ (ุงููุฑุญูุฉ 4)

| ุงูุฏุงูุฉ | ุงูุชูููุน | ููุฑุฌุน | ุงููุตู |
|--------|---------|-------|-------|
| `getDailyLoss` | `(Carbon $date, ?int $branchId): float` | float | ุฅุฌูุงูู ุชูููุฉ ุงูุชุฃุฎูุฑ ุนุจุฑ ุงููุฑูุน ูุชุงุฑูุฎ ูุนูู |
| `getBranchPerformance` | `(Carbon $month): Collection` | Collection | ุฅุญุตุงุฆูุงุช ููู ูุฑุน: ุฅุฌูุงูู_ุงูููุธูููุ ูุนุฏู_ุงูุญุถูุฑุ ุงูุชุฒุงู_ุงูุณูุงุฌุ ุฅุฌูุงูู_ุงูุฎุณุงุฑุฉ |
| `getDelayImpactAnalysis` | `(string $start, string $end, string $scope, ?int $scopeId): array` | array | ุชุญููู ุงูุนุงุฆุฏ: ุงูุฎุณุงุฑุฉ_ุงููุญุชููุฉุ ุงูุฎุณุงุฑุฉ_ุงููุนููุฉุ ูุณุจุฉ_ุงูุนุงุฆุฏุ ูููุฑุงุช_ุงูุงูุถุจุงุท |
| `getPredictiveMonthlyLoss` | `(Carbon $month): array` | array | ุชููุนุงุช ุชูุจุคูุฉ: ูุชูุณุท_ุงูุฎุณุงุฑุฉ_ุงูููููุฉุ ุงูุฎุณุงุฑุฉ_ุงููุชุฑุงููุฉุ ุงูุฃูุงู_ุงููุชุจููุฉุ ุงูุฅุฌูุงูู_ุงููุชููุน |

---

## ยง33. ูุฏุฌุงุช ููุญุฉ ุชุญูู Filament (ุงููุฑุญูุฉ 4)

| ุงููุฏุฌุฉ | ุงููุฆุฉ ุงูุฃุจ | ุงูุฏูุงู ุงูุฑุฆูุณูุฉ |
|--------|-----------|----------------|
| `RealTimeLossCounter` | StatsOverviewWidget | `getStats()` โ ุฎุณุงุฑุฉ ุงููููุ ุนุฏุฏ ุงููุชุฃุฎุฑููุ ุนุฏุฏ ุงูุบุงุฆุจููุ ุงุชุฌุงู ุงูุฎุณุงุฑุฉ |
| `BranchPerformanceHeatmap` | TableWidget | `table()` โ ุตููู ุงููุฑูุน ูุน ูุนุฏู_ุงูุญุถูุฑุ ุงูุงูุชุฒุงูุ ุฃุนูุฏุฉ ุงูุฎุณุงุฑุฉุ ููููููุฉ |
| `IntegrityAlertHub` | TableWidget | `table()` โ ุขุฎุฑ ุชูุนููุงุช ุงููุตุงุฆุฏ + ุญุงูุงุช ุงูุจูุงุบุงุช (ุจูุงุจุฉ ุงููุณุชูู 10) |

---

## ยง34. ุตูุญุงุช ุงููุจู ูููุณุชูู 10 (ุงููุฑุญูุฉ 4)

| ุงูุตูุญุฉ | ุงููุณุงุฑ | ุงูุฏูุงู |
|--------|--------|--------|
| `WhistleblowerVaultPage` | `/admin/whistleblower-vault` | `table()` โ ุนุฑุถ ุงูุจูุงุบุงุช ุงููููููู ุชุดููุฑูุงุ `viewReport()` โ ูู ุชุดููุฑ ููุณุฌูู ูู ุงูุชุฏููู |
| `TrapAuditPage` | `/admin/trap-audit` | `table()` โ ูุณุงุฑ ุงูุชุฏููู ุงููุงูู ููุชูุงุนูุงุชุ ุจูุงูุงุช ูุณุงุฑ ุงููุฎุงุทุฑ |

---

## ุณุฌู ุงูุชุบููุฑุงุช

| ุงูุชุงุฑูุฎ | ุงูุฅุตุฏุงุฑ | ุงูุชุบููุฑุงุช |
|---------|---------|----------|
| 2026-02-07 | 1.0.0 | ุงูุณุฌู ุงูุฃููู โ 20 ูููุฐุฌุ 50+ ุฏุงูุฉ ูููุซููุฉ |
| 2026-02-07 | 1.1.0 | ุงููุฑุญูุฉ 1 โ ุฎุฏูุฉ ุงูุณูุงุฌ ุงูุฌุบุฑุงูู (ุฏุงูุชุงู)ุ ุฎุฏูุฉ ุงูุญุถูุฑ (3 ุฏูุงู)ุ ูุชุญูู ุงูุญุถูุฑ (3 ููุงุท ูุตูู) |
| 2026-02-07 | 1.2.0 | ุงููุฑุญูุฉ 2 โ ูููุฐุฌ ุงููุตูุฏุฉ (ุฏุงูุชุงูุ ูุทุงูุงู)ุ ุฅุถุงูุงุช ูุฎุงุทุฑ ุงููุณุชุฎุฏู (ุฏุงูุชุงู)ุ ุฎุฏูุฉ ุงุณุชุฌุงุจุฉ ุงููุตุงุฆุฏ (ุฏุงูุชุงู)ุ ูุชุญูู ุงููุตุงุฆุฏ (ููุทุฉ ูุตูู ูุงุญุฏุฉ) |
| 2026-02-07 | 1.3.0 | ุงููุฑุญูุฉ 3 โ 8 ููููุงุช Livewireุ 3 ูุชุญููุงุชุ 6 ูุณุงุฑุงุชุ ุชุฎุทูุท PWAุ ุณูุฑ ุชุดููุฑ ุงูุจูุงุบุงุชุ ุงููุฑุงุณูุงุช ูุน ุฅูุตุงูุงุช ุงููุฑุงุกุฉ |
| 2026-02-08 | 1.4.0 | ุงููุฑุญูุฉ 4 โ ุฎุฏูุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ (4 ุฏูุงู)ุ 3 ูุฏุฌุงุช ููุญุฉ ุชุญููุ ุตูุญุชุง ูุจู ูููุณุชูู 10ุ ุฎูุงุฑุฒููุฉ ุงูุชุญูููุงุช ุงูุชูุจุคูุฉ |
| 2026-02-08 | 1.5.0 | ุงููุฑุญูุฉ 5 (ุงูููุงุฆูุฉ) โ ุฃูุฑ SarhInstallุ ุณูุงุณุฉ ูุทุงู ุงููุฑุนุ ุทุจูุฉ ุงูุชุฎุฒูู ุงููุงูู ุงููุคูุชุ ููุงุฑุณ ุงูุฃุฏุงุกุ ุชูููุฉ ุซูุงุฆูุฉ ุงููุบุฉ |

---

## ยง35. ุชูููุฉ ุจูุฆุฉ ุงูุฅูุชุงุฌ (ุงููุฑุญูุฉ 5 โ ุงูููุงุฆูุฉ)

### ุฃูุฑ ุงูุชุซุจูุช (`App\Console\Commands\SarhInstallCommand`)
- **ุงูุชูููุน:** `sarh:install`
- **ุงูุบุฑุถ:** ุชุซุจูุช ุจุฃูุฑ ูุงุญุฏ โ ูุจุฐุฑ RBAC ูุงูุดุงุฑุงุช ูุงููุตุงุฆุฏ ููููุดุฆ ุงููุฏูุฑ ุงูุฃุนูู ุงูุฃููู
- **ุงูุฎุทูุงุช:**
  1. `verifyEnvironment()` โ ูุชุญูู ูู ุฅุตุฏุงุฑ PHP ูุงูุฅุถุงูุงุช ูAPP_KEY ูุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  2. `runMigrations()` โ ูููููุฐ `php artisan migrate --force`
  3. `seedCoreData()` โ ูุณุชุฏุนู RolesAndPermissionsSeeder ูBadgesSeeder ูTrapsSeeder
  4. `createSuperAdmin()` โ ูุทูุจ ุชูุงุนููุงู name_ar ูname_en ูุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ โ ูููุดุฆ ูุณุชุฎุฏู ุจุงููุณุชูู 10
  5. `finalizeInstallation()` โ `storage:link`ุ `config:cache`ุ `route:cache`

### ุฎุฏูุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ โ ุทุจูุฉ ุงูุชุฎุฒูู ุงููุคูุช
- **ูุฏุฉ ุงูุชุฎุฒูู:** 300 ุซุงููุฉ (5 ุฏูุงุฆู)
- **ููุฎุฒูู ูุคูุชุงู:** `getDailyLoss`ุ `getBranchPerformance`ุ `getPredictiveMonthlyLoss`
- **ูุง ููุฎุฒูู ูุคูุชุงู:** `getDelayImpactAnalysis` (ุนูุฏ ุงูุทูุจุ ูููุนูู ูู ุงููุณุชุฎุฏู)
- **ุชูุณูู ุงูููุชุงุญ:** `sarh.{method}.{date/month}.{branch_id?}`

### ุณูุงุณุฉ ูุทุงู ุงููุฑุน ุงูุฃูููุฉ
- **ููุทุจููุฉ ูู:** `getEloquentQuery()` ูู AttendanceLogResource
- **ุงูููุทู:** ุบูุฑ ุงููุฏูุฑ ุงูุฃุนูู ูุฑู ุจูุงูุงุช `branch_id` ุงูุฎุงุต ุจู ููุท
- **ุงููุฏูุฑ ุงูุฃุนูู:** ุจุฏูู ูููุฏ ุนูู ุงููุทุงู

### ููุงุฑุณ ุงูุฃุฏุงุก (ุงูุชุฑุญูู)
- **ุงูุฌุฏูู:** `attendance_logs` โ 3 ููุงุฑุณ ุฌุฏูุฏุฉ (delay_costุ user_id+statusุ attendance_date+delay_cost)
- **ุงูุฌุฏูู:** `trap_interactions` โ 3 ููุงุฑุณ ุฌุฏูุฏุฉ (trap_idุ created_atุ user_id+created_at)
- **ุงูุฌุฏูู:** `audit_logs` โ ููุฑุณุงู ุฌุฏูุฏุงู (user_idุ action)

### ุฅุถุงูุงุช ุซูุงุฆูุฉ ุงููุบุฉ
- **ุงูููู:** `lang/{ar,en}/install.php` โ 15+ ููุชุงุญ ููุฎุฑุฌุงุช ุฃูุฑ ุงูุชุซุจูุช

---

## ยง36. ุฅุนุงุฏุฉ ููููุฉ ุงููุงุฌูุฉ โ ุจููุฉ ุงูููุงุฑุฏ (ุงูุฅุตุฏุงุฑ 1.6.0)

### ููุฑุฏ ุงููุณุชุฎุฏููู (`App\Filament\Resources\UserResource`)

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| `getEloquentQuery()` | ูุทุงู ุงููุฑุน โ ุบูุฑ ุงููุฏูุฑ ุงูุฃุนูู ูุฑู ููุธูู ูุฑุนู ููุท |
| `form()` | ูุฎุทุท ุงูุญููู ุงูุฃุณุงุณูุฉ ุงูุฃุฑุจุนุฉ: ุงูุตูุฑุฉ (ูุทููุจุฉ)ุ ุงูุงุณู ุจุงูุนุฑุจู/ุงูุฅูุฌููุฒูุ ุงูุจุฑูุฏุ ูููุฉ ุงููุฑูุฑุ ุงูุฑุงุชุจ ุงูุฃุณุงุณู + ูุณู ุชูุธููู ูุงุจู ููุทู |
| `table()` | ุนููุฏ ุงูุตูุฑุฉุ ุดุงุฑุฉ ุฑูู ุงูููุธูุ ุงูุงุณูุ ุงูุจุฑูุฏุ ุงููุฑุนุ ุงูุฏูุฑุ ุงูุฑุงุชุจุ ุดุงุฑุฉ ุงููุณุชูู ุงูุฃููู ููููููุฉุ ุฃููููุฉ ุงูุญุงูุฉ |
| ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงููุฎููุฉ | `working_days_per_month=22`ุ `working_hours_per_day=8`ุ `locale=ar`ุ `timezone=Asia/Riyadh` |

### ููุฑุฏ ุงููุฑูุน (`App\Filament\Resources\BranchResource`)

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| `form()` | ูุณู ุงููููุฉ + ููุชูู ุฎุฑูุทุฉ Leaflet.js (ViewField) + ุญููู ุงูุฅุญุฏุงุซูุงุช/ูุตู ุงููุทุฑ + ุฃูุณุงู ูุงุจูุฉ ููุทู ููููุงูุจุฉ/ุงูุนููุงู/ุงููุงููุฉ |
| `table()` | ุดุงุฑุฉ ุงูููุฏุ ุงูุฃุณูุงุกุ ุงููุฏููุฉุ ูุตู ูุทุฑ ุงูุณูุงุฌุ ุฃููุงุช ุงูููุงูุจุฉุ ูุชุฑุฉ ุงูุณูุงุญุ ุนุฏุฏ ุงูููุธูููุ ุฃููููุฉ ุงููุดุงุท |
| ููุชูู ุงูุฎุฑูุทุฉ | `filament.forms.components.map-picker` โ Alpine.js + Leaflet.js ูุน ุฑุจุท ุซูุงุฆู ุงูุงุชุฌุงู ููุฅุญุฏุงุซูุงุช/ูุตู ุงููุทุฑ |

### ูููู ููุชูู ุงูุฎุฑูุทุฉ (`resources/views/filament/forms/components/map-picker.blade.php`)

| ุงูููุฒุฉ | ุงูุชูููุฐ |
|--------|---------|
| ูุญุฑู ุงูุฎุฑุงุฆุท | Leaflet.js ุงูุฅุตุฏุงุฑ 1.9.4 ูุน ุทุจูุงุช OpenStreetMap |
| ุงูุนูุงูุฉ | ูุงุจูุฉ ููุณุญุจุ ุชูุญุฏูุซ ุงูุฅุญุฏุงุซูุงุช ุนูุฏ ุงูุณุญุจ |
| ูุนุงูุฌ ุงูููุฑ | ุงูููุฑ ุนูู ุงูุฎุฑูุทุฉ ูุถุน ุงูุนูุงูุฉ + ููุญุฏูุซ ุงูุฅุญุฏุงุซูุงุช |
| ุฏุงุฆุฑุฉ ุงูุณูุงุฌ | ุจุฑุชูุงูู (#f97316)ุ ุดูุงููุฉ 15%ุ ูุตู ุงููุทุฑ ูุชุฒุงูู ูุน ุญูู ุงููููุฐุฌ |
| ุงููุฑุงูุจูู | `$watch('radius')`ุ `$watch('lat')`ุ `$watch('lng')` โ ูุฒุงููุฉ ุซูุงุฆูุฉ ุงูุงุชุฌุงู |
| ุงููุฑูุฒ ุงูุงูุชุฑุงุถู | ุงูุฑูุงุถ: 24.7136, 46.6753 |

### AppServiceProvider โ ุจูุงุจุงุช ุงููุณุชูู 10

| ุงูุจูุงุจุฉ | ุงูุดุฑุท | ุงูุชุฃุซูุฑ |
|---------|-------|---------|
| `Gate::before()` | `security_level === 10 \|\| is_super_admin` | ุชูุฑุฌุน `true` ูุฌููุน ุนูููุงุช ุงูุชุญูู ูู ุงูุตูุงุญูุงุช |
| `access-whistleblower-vault` | `security_level >= 10` | ุงููุตูู ูุตูุญุฉ ุงููุจู |
| `access-trap-audit` | `security_level >= 10` | ุงููุตูู ูุตูุญุฉ ุชุฏููู ุงููุตุงุฆุฏ |
| `bypass-geofence` | `security_level >= 10 \|\| is_super_admin` | ุชุณุฌูู ุญุถูุฑ ูู ุฃู ูููุน |

### ูููุงุช ุงููุบุฉ ุซูุงุฆูุฉ ุงููุบุฉ ุงูููุถุงูุฉ
- **ุงูููู:** `lang/{ar,en}/users.php` โ 30+ ููุชุงุญ ููุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูููุธููู
- **ุงูููู:** `lang/{ar,en}/branches.php` โ 30+ ููุชุงุญ ููุงุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฑูุน

---

## ยง37. ูุญุฑู ุงูููุงูุณุฉ โ ููุญุฉ ุชุฑุชูุจ ุงููุฑูุน ูุดุฑูุท ุงูุฃุฎุจุงุฑ (ุงูุฅุตุฏุงุฑ 1.7.0)

### ุจุฐูุงุฑ ุจูุงูุงุช ุงููุดุฑูุน (`Database\Seeders\ProjectDataSeeder`)

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| `run()` | ูุจุฐุฑ 5 ูุฑูุน (ุฅุญุฏุงุซูุงุช GPS + ุณูุงุฌ 17 ูุชุฑ) + 36 ูุณุชุฎุฏู ูุน `updateOrCreate` ูุถูุงู ุนุฏู ุงูุชูุฑุงุฑ |
| ุชูุฒูุน ุงููุฑูุน | FADA-2: 11ุ FADA-1: 8ุ SARH-CORNER: 7ุ SARH-2: 5ุ SARH-HQ: 4 |
| ูููุฉ ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ | `Goolbx512!!` ูุฌููุน ุงููุณุชุฎุฏููู ุงููุจุฐูุฑูู |
| ุงููุฏูุฑ ุงูุฃุนูู | `abdullah@sarh.app` (emp001) โ security_level=10ุ total_points=500 |

### ุตูุญุฉ ููุญุฉ ุชุฑุชูุจ ุงููุฑูุน (`App\Filament\Pages\BranchLeaderboardPage`)

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| `getBranches()` | ููุฑุชูุจ ุงููุฑูุน ุญุณุจ **ุฃูู ุฎุณุงุฑุฉ ูุงููุฉ** ูู ุงูุชุฃุฎูุฑ. ูุญุณุจ ุฏุฑุฌุฉ ุงูุงูุถุจุงุท ูุชุนููู ุงููุณุชูู: ุงูุฃุณุงุณ 100ุ -2/ูุชุฃุฎุฑุ -5/ุบุงุฆุจุ +10/ููุธู ูุซุงููุ +0.1รุงูููุงุท. ููุฑุฌุน ูุตูููุฉ ููุฑุชูุจุฉ ูุน ุชุนููู 6 ูุณุชููุงุช |
| ูุณุชููุงุช ุงูุชุตููู | ุฃุณุทูุฑู (โฅ150)ุ ุฃููุงุณู (โฅ120)ุ ุฐูุจู (โฅ100)ุ ูุถู (โฅ80)ุ ุจุฑููุฒู (โฅ60)ุ ูุจุชุฏุฆ (<60) |
| ุงููุฃุณ/ุงูุณูุญูุงุฉ | ุงูุชุฑุชูุจ ุญุณุจ ุฃูู ุฎุณุงุฑุฉ ูุงููุฉุ ุดุฑูุท ุงูุฃุฎุจุงุฑ ูุนุฑุถ ููู ูุฑุน ๐ ุฃูู ุญุถูุฑ / ๐ข ุขุฎุฑ ุญุถูุฑ |

### ุดุฑูุท ุงูุฃุฎุจุงุฑ ุงููููู (`App\Filament\Widgets\DailyNewsTicker`)

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| `getNewsItems()` | ูุฌูุน ุฃุฎุจุงุฑ ุงูููุงูุณุฉ ุงูููููุฉ: ุฃูู/ุขุฎุฑ ุญุถูุฑ ููู ูุฑุนุ ุฅุญุตุงุฆูุงุช ุงูุญุถูุฑุ ุฃุนูู ููุณุฌููุ ุฅุฌูุงูู ุงูููุธููู |
| `getTrophyFirstCheckin()` | ๐ ุฃูู ุญุถูุฑ ููู ูุฑุน ุงูููู (ุฃุจูุฑ `check_in_at` ูู AttendanceLog ููู ูุฑุน) |
| `getTurtleLastCheckin()` | ๐ข ุขุฎุฑ ุญุถูุฑ ููู ูุฑุน ุงูููู (ุฃุญุฏุซ `check_in_at` ูู AttendanceLog ููู ูุฑุน) |

### ุฅุฌุฑุงุก ุงูููุงุท ูู ููุฑุฏ ุงููุณุชุฎุฏููู

| ุงูุฏุงูุฉ | ุงูุบุฑุถ |
|--------|-------|
| ุฅุฌุฑุงุก `adjust_points` | ุฅุฌุฑุงุก ุฌุฏูู Filament โ ุงููุณุชูู 10 ููุฏุฎู ุงูููุงุท + ุงูุณุจุจ โ ุฒูุงุฏุฉ `total_points` + ุณุฌู ูู ูููุฐุฌ `PointsTransaction` + ุฅุดุนุงุฑ ูุฎุจ |
| ุงูุจูุงุจุฉ | `adjust-points` โ ูุชุทูุจ security_level โฅ 10 ุฃู is_super_admin |

### AppServiceProvider โ ุจูุงุจุงุช ุงูููุงูุณุฉ (ุงูุฅุตุฏุงุฑ 1.7.0)

| ุงูุจูุงุจุฉ | ุงูุดุฑุท | ุงูุชุฃุซูุฑ |
|---------|-------|---------|
| `manage-competition` | `security_level >= 10 \|\| is_super_admin` | ุฅุฏุงุฑุฉ ุตูุญุฉ ุงูููุงูุณุฉ |
| `adjust-points` | `security_level >= 10 \|\| is_super_admin` | ุชุนุฏูู ุงูููุงุท ูุฏููุงู |

### ูููุงุช ุงููุบุฉ ุซูุงุฆูุฉ ุงููุบุฉ ุงูููุถุงูุฉ (ุงูุฅุตุฏุงุฑ 1.7.0)
- **ุงูููู:** `lang/{ar,en}/competition.php` โ 30+ ููุชุงุญ ููุงุฌูุฉ ุงูููุงูุณุฉ (ุงูุชุฑุชูุจุ ุงููุณุชููุงุชุ ุงูุดุฑูุทุ ุงูุชุณุฌูู)
- **ุงูููู:** `lang/{ar,en}/users.php` โ 7 ููุงุชูุญ ุฌุฏูุฏุฉ ูุฅุฏุงุฑุฉ ุงูููุงุท

